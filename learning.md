ç³»ç»Ÿçš„åŠ¨æ€åˆ†é…å‡½æ•°new malloc free delete

stlç›¸å…³

mutex

size_t

å³å€¼å¼•ç”¨



ç”³è¯·ä¸€å—è¾ƒå¤§çš„å†…å­˜å—ï¼Œä¹‹åå°†è¿™å—å†…å­˜çš„ç®¡ç†æ”¾åœ¨åº”ç”¨å±‚è¿›è¡Œï¼Œå‡å°ç³»ç»Ÿè°ƒç”¨å¸¦æ¥çš„å¼€é”€

- å‡å°åŠ¨æ€å†…å­˜åˆ†é…çš„å¼€é”€
- é¿å…å†…å­˜ç¢ç‰‡
- é™ä½ç³»ç»Ÿè°ƒç”¨é¢‘ç‡
- æ‹¥æœ‰ç¨³å®šçš„åˆ†é…æ—¶é—´

é€‚ç”¨åœºåˆï¼šæ¸¸æˆå¼€å‘ä¸­å¤§é‡å°å¯¹è±¡ã€é«˜æ€§èƒ½è®¡ç®—ã€webæœåŠ¡å™¨å’Œæ•°æ®åº“æœåŠ¡å™¨å¤„ç†å¤§é‡è¿æ¥å’Œè¯·æ±‚

ç¼ºç‚¹ï¼šéœ€è¦é¢„å…ˆåˆ†é…è¾ƒå¤§çš„å†…å­˜åŒºåŸŸï¼Œå¯èƒ½æµªè´¹ä¸€äº›å†…å­˜ï¼›å¯¹å¤§å¯¹è±¡çš„åˆ†é…å¹¶ä¸åˆ’ç®—



## cppåŸºç¡€



### æ•°æ®ç±»å‹

| æ•°æ®ç±»å‹      | 32 ä½ç³»ç»Ÿ   | 64 ä½ç³»ç»Ÿ | è¯´æ˜                                             |
| ------------- | ----------- | --------- | ------------------------------------------------ |
| `bool`        | 1           | 1         | ä»…èƒ½å– `true` æˆ– `false`                         |
| `char`        | 1           | 1         | å­˜å‚¨å•ä¸ªå­—ç¬¦ï¼ˆASCII æˆ– Unicodeï¼‰                 |
| `wchar_t`     | 2 æˆ– 4      | 4         | å®½å­—ç¬¦ç±»å‹ï¼ˆå­˜å‚¨ Unicodeï¼‰                       |
| `char16_t`    | 2           | 2         | 16 ä½å­—ç¬¦ï¼ˆUTF-16ï¼‰                              |
| `char32_t`    | 4           | 4         | 32 ä½å­—ç¬¦ï¼ˆUTF-32ï¼‰                              |
| `short`       | 2           | 2         | çŸ­æ•´æ•°ï¼ˆé€šå¸¸ä¸º 16 ä½ï¼‰                           |
| `int`         | 4           | 4         | æ ‡å‡†æ•´æ•°ï¼ˆé€šå¸¸ä¸º 32 ä½ï¼‰                         |
| `long`        | 4           | 8         | åœ¨ 32 ä½ç³»ç»Ÿä¸­ä¸º 4 å­—èŠ‚ï¼Œåœ¨ 64 ä½ç³»ç»Ÿä¸­ä¸º 8 å­—èŠ‚ |
| `long long`   | 8           | 8         | é•¿æ•´å‹ï¼ˆé€šå¸¸ä¸º 64 ä½ï¼‰                           |
| `float`       | 4           | 4         | å•ç²¾åº¦æµ®ç‚¹æ•°ï¼ˆIEEE 754 æ ‡å‡†ï¼‰                    |
| `double`      | 8           | 8         | åŒç²¾åº¦æµ®ç‚¹æ•°ï¼ˆIEEE 754 æ ‡å‡†ï¼‰                    |
| `long double` | 8ã€12 æˆ– 16 | 16        | å¯èƒ½å› ç¼–è¯‘å™¨ä¸åŒè€Œå˜åŒ–                           |

**æŒ‡é’ˆç±»å‹**

| æŒ‡é’ˆç±»å‹                              | 32 ä½ç³»ç»Ÿ | 64 ä½ç³»ç»Ÿ | è¯´æ˜                               |
| ------------------------------------- | --------- | --------- | ---------------------------------- |
| æŒ‡å‘ `char`ã€`int`ã€`double` ç­‰çš„æŒ‡é’ˆ | 4         | 8         | æŒ‡é’ˆçš„å¤§å°å–å†³äºå¹³å°åœ°å€æ€»çº¿çš„å®½åº¦ |

- `sizeof(type)` å¯ä»¥ç”¨äºæŸ¥çœ‹æ•°æ®ç±»å‹çš„å…·ä½“å¤§å°ã€‚
- `long` åœ¨ 32 ä½ç³»ç»Ÿä¸­é€šå¸¸æ˜¯ 4 å­—èŠ‚ï¼Œè€Œåœ¨ 64 ä½ç³»ç»Ÿä¸­å¯èƒ½æ˜¯ 8 å­—èŠ‚ï¼ˆå¦‚ Linuxï¼‰ã€‚



### å¸¸é‡æŒ‡é’ˆä¸æŒ‡é’ˆå¸¸é‡

**å¸¸é‡æŒ‡é’ˆ**

`*p`ï¼ˆæŒ‡å‘çš„å€¼ï¼‰ä¸èƒ½ä¿®æ”¹ï¼Œä½† `p`ï¼ˆæŒ‡é’ˆæœ¬èº«ï¼‰å¯ä»¥æ”¹å˜æŒ‡å‘å…¶ä»–åœ°å€ã€‚

```cpp
const int *p;  // ç­‰ä»·äº int const *p;
```

**æŒ‡é’ˆå¸¸é‡**

æŒ‡é’ˆæœ¬èº«ä¸å¯ä¿®æ”¹ï¼Œä½†å®ƒæŒ‡å‘çš„å€¼å¯ä»¥æ›´æ”¹

```cpp
int *const p = &a;
```



### defineã€typedefå’Œinline

#### define

`#define` æ˜¯ é¢„å¤„ç†æŒ‡ä»¤ï¼Œç”¨äºå®šä¹‰ å®ï¼Œå¯ä»¥ç”¨æ¥å®šä¹‰ å¸¸é‡ æˆ– ä»£ç ç‰‡æ®µã€‚å®ƒæ˜¯åœ¨ ç¼–è¯‘å‰ ç”± é¢„å¤„ç†å™¨ è¿›è¡Œæ›¿æ¢çš„ï¼Œè€Œä¸æ˜¯ç”±ç¼–è¯‘å™¨è§£æçš„ã€‚

- æ²¡æœ‰ç±»å‹æ£€æŸ¥ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ„æƒ³ä¸åˆ°çš„é”™è¯¯ã€‚
- åªæ˜¯ ç®€å•çš„æ–‡æœ¬æ›¿æ¢ã€‚
- æ— æ³•è°ƒè¯•ï¼ˆå› ä¸ºå®ƒåœ¨ç¼–è¯‘å‰è¢«æ›¿æ¢ï¼‰ã€‚

```cpp
#define PI 3.14159  // å®šä¹‰å¸¸é‡
#define SQUARE(x) ((x) * (x))  // å®å‡½æ•°
```

æ³¨æ„ï¼š

```cpp
cout << SQUARE(5 + 1) << endl;  // æœŸå¾… (5+1) * (5+1) = 36
```

ç”±äº `#define SQUARE(x) ((x) * (x))`ï¼Œå®é™…å±•å¼€æ˜¯ï¼š

```cpp
((5+1) * (5+1))  // ç»“æœï¼š6 * 6 = 36
```

å¦‚æœ `#define SQUARE(x) (x * x)`ï¼Œé‚£ä¹ˆï¼š

```cpp
(5+1 * 5+1)  // ç»“æœï¼š5 + 5 + 1 = 11ï¼ˆé”™è¯¯ï¼ï¼‰
```

ä½¿ç”¨ `#define` å®šä¹‰å®æ—¶ï¼Œå‚æ•°æœ€å¥½ç”¨æ‹¬å·æ‹¬èµ·æ¥ï¼Œé¿å…è¿ç®—ç¬¦ä¼˜å…ˆçº§é—®é¢˜ã€‚



#### typedef

`typedef` ç”¨äºç»™å·²æœ‰çš„ç±»å‹ **åˆ›å»ºä¸€ä¸ªæ–°çš„åç§°**ï¼Œè®©ä»£ç æ›´ç®€æ´æ˜“è¯»ã€‚

- åªåšç±»å‹é‡å‘½åï¼Œä¸ä¼šåˆ›å»ºæ–°çš„æ•°æ®ç±»å‹ã€‚
- åœ¨ç¼–è¯‘æ—¶ç”Ÿæ•ˆï¼ˆä¸åƒ `#define` åªæ˜¯æ–‡æœ¬æ›¿æ¢ï¼‰ã€‚
- æ”¯æŒå¤æ‚ç±»å‹ï¼Œå¯æé«˜å¯è¯»æ€§ã€‚

```cpp
#include <iostream>
using namespace std;

typedef unsigned int uint;  // uint æ˜¯ unsigned int çš„åˆ«å
typedef int* IntPtr;  // IntPtr ä»£è¡¨ int* ç±»å‹

int main() {
    uint a = 100;  // ç­‰ä»·äº unsigned int a = 100;
    IntPtr p;  // ç­‰ä»·äº int* p;
    cout << "a: " << a << endl;
    return 0;
}
```

**æ³¨æ„**

```cpp
typedef int* IntPtr;
IntPtr p1, p2;
```

è¿™é‡Œçš„ `p1` å’Œ `p2` **éƒ½æ˜¯ `int\*` æŒ‡é’ˆ**ï¼Œå› ä¸º `typedef` **ç›´æ¥æ›¿æ¢ç±»å‹**ï¼Œä¸ä¼šå½±å“å˜é‡å®šä¹‰çš„æ–¹å¼ã€‚

**C++11 æ–°ç‰¹æ€§ï¼š`using`**

```cpp
using uint = unsigned int;  // ç­‰ä»·äº typedef unsigned int uint;
using IntPtr = int*;  // ç­‰ä»·äº typedef int* IntPtr;
```

ç›¸æ¯” `typedef`ï¼Œ`using` **å¯è¯»æ€§æ›´å¥½**ï¼Œå¹¶ä¸”å¯ä»¥ç”¨äº **æ¨¡æ¿åˆ«å**ï¼Œæ¨èåœ¨ C++ ä»£ç ä¸­ä½¿ç”¨ `using`ã€‚



#### inline

`inline` ç”¨äºä¿®é¥° **å‡½æ•°**ï¼Œå»ºè®®ç¼–è¯‘å™¨åœ¨è°ƒç”¨è¯¥å‡½æ•°æ—¶ **ç›´æ¥å±•å¼€ä»£ç **ï¼Œå‡å°‘å‡½æ•°è°ƒç”¨çš„å¼€é”€ã€‚

- å‡å°‘å‡½æ•°è°ƒç”¨å¼€é”€ï¼Œæé«˜æ•ˆç‡ï¼ˆé€‚ç”¨äº çŸ­å°å‡½æ•°ï¼‰ã€‚
- ç”±ç¼–è¯‘å™¨å†³å®šæ˜¯å¦çœŸæ­£å†…è”ï¼ˆä¸æ˜¯å¼ºåˆ¶çš„ï¼‰ã€‚
- é¿å… `#define` å®çš„ç¼ºç‚¹ï¼ˆæ”¯æŒç±»å‹æ£€æŸ¥ã€è°ƒè¯•ï¼‰ã€‚

```cpp
#include <iostream>
using namespace std;

inline int square(int x) {  // å»ºè®®ç¼–è¯‘å™¨å†…è”
    return x * x;
}

int main() {
    cout << "square(5): " << square(5) << endl;  // ç»“æœï¼š25
    return 0;
}
```

**ç­‰ä»·äº**

```cpp
cout << "square(5): " << (5 * 5) << endl;
```



### new malloc delete free





### constå’Œconstexpr

åœ¨ C++ ä¸­ï¼Œ`const` å’Œ `constexpr` éƒ½ç”¨äº **å£°æ˜å¸¸é‡**ï¼Œä½†å®ƒä»¬çš„ **ä½¿ç”¨åœºæ™¯å’Œç‰¹æ€§** æœ‰ä¸€äº›å…³é”®åŒºåˆ«ã€‚

#### const

`const` å…³é”®å­— **ç”¨äºå£°æ˜ä¸å¯ä¿®æ”¹çš„å˜é‡**ï¼Œä½†å®ƒçš„å€¼ **ä¸ä¸€å®šåœ¨ç¼–è¯‘æ—¶å·²çŸ¥**ï¼Œå¯ä»¥åœ¨ **è¿è¡Œæ—¶åˆå§‹åŒ–**ã€‚

- å˜é‡å£°æ˜å **ä¸å¯ä¿®æ”¹**ã€‚
- **å¯ä»¥åœ¨è¿è¡Œæ—¶åˆå§‹åŒ–**ï¼ˆä½†å¦‚æœæ˜¯å…¨å±€ `const`ï¼Œä»ç„¶éœ€è¦ç¼–è¯‘æ—¶åˆå§‹åŒ–ï¼‰ã€‚
- ä¸èƒ½ä½œä¸ºæ•°ç»„å¤§å°ï¼ˆé™¤éæ˜¯å…¨å±€æˆ–é™æ€ `const`ï¼‰ã€‚
- **é»˜è®¤æ˜¯å†…é“¾æ¥**ï¼ˆ`static` ä½œç”¨åŸŸï¼‰ã€‚

```cpp
#include <iostream>
using namespace std;

int getValue() {
    return 42;
}

int main() {
    int x = 10;
    const int a = 5;  // âœ… ç¼–è¯‘æ—¶å¯ç¡®å®šå€¼
    const int b = x;  // âœ… è¿è¡Œæ—¶ç¡®å®šå€¼
    // int arr[a];  // âœ… å¯ä»¥ç”¨ä½œæ•°ç»„å¤§å°
    // int arr[b];  // âŒ é”™è¯¯ï¼Œb ä¸æ˜¯ç¼–è¯‘æ—¶å¸¸é‡

    cout << "a: " << a << ", b: " << b << endl;
    return 0;
}
```

> **æ³¨æ„ï¼š** `const int b = x;` **å…è®¸ä½¿ç”¨** `x` çš„å€¼è¿›è¡Œåˆå§‹åŒ–ï¼Œè€Œ `constexpr` ä¸èƒ½è¿™æ ·åšã€‚

------



#### constexpr

`constexpr` ç”¨äºå£°æ˜ **ç¼–è¯‘æœŸå¸¸é‡**ï¼Œ**å®ƒçš„å€¼å¿…é¡»åœ¨ç¼–è¯‘æ—¶å¯ç¡®å®š**ã€‚

- **å¿…é¡»åœ¨ç¼–è¯‘æ—¶åˆå§‹åŒ–**ï¼Œä¸èƒ½ä¾èµ–è¿è¡Œæ—¶è®¡ç®—çš„å€¼ã€‚
- **å¯ç”¨äºæ•°ç»„å¤§å°ã€æ¨¡æ¿å‚æ•°ç­‰** éœ€è¦ç¼–è¯‘æœŸå¸¸é‡çš„åœ°æ–¹ã€‚
- **è‡ªåŠ¨å†…è”ï¼ˆ`inline`ï¼‰**ï¼Œå¯ä»¥ç”¨äº **å‡½æ•°å’Œç±»æˆå‘˜**ã€‚
- **é€‚ç”¨äºç¼–è¯‘æœŸè®¡ç®—çš„åœºæ™¯**ï¼ˆå¦‚ `constexpr` å‡½æ•°ï¼‰ã€‚

```cpp
#include <iostream>
using namespace std;

constexpr int getConstValue() { return 10; }

int main() {
    constexpr int a = 5;   // âœ… ç¼–è¯‘æ—¶å¸¸é‡
    constexpr int b = getConstValue();  // âœ… å…è®¸ï¼Œè¿”å›å€¼æ˜¯ constexpr
    // int x = 10;
    // constexpr int c = x;  // âŒ é”™è¯¯ï¼Œx ä¸èƒ½ç”¨äº constexpr åˆå§‹åŒ–

    int arr[a];  // âœ… å¯ä»¥ç”¨ä½œæ•°ç»„å¤§å°
    cout << "a: " << a << ", b: " << b << endl;
    return 0;
}
```

> **æ³¨æ„ï¼š** `constexpr` å˜é‡çš„å€¼ **å¿…é¡»èƒ½åœ¨ç¼–è¯‘æ—¶ç¡®å®š**ï¼Œæ‰€ä»¥ä¸èƒ½ç”¨è¿è¡Œæ—¶å˜é‡ `x` è¿›è¡Œåˆå§‹åŒ–ã€‚



#### constexprå‡½æ•°

C++11 å¼•å…¥äº† `constexpr` **å‡½æ•°**ï¼Œå¯ä»¥åœ¨ç¼–è¯‘æœŸ **è¿›è¡Œè®¡ç®—**ã€‚

```cpp
#include <iostream>
using namespace std;

constexpr int square(int x) { return x * x; }

int main() {
    constexpr int result = square(5);  // âœ… è®¡ç®—åœ¨ç¼–è¯‘æœŸå®Œæˆ
    int x = 10;
    int runtime_result = square(x);  // âœ… è¿è¡Œæ—¶è®¡ç®—
    cout << "result: " << result << ", runtime_result: " << runtime_result << endl;
    return 0;
}
```

> **æ³¨æ„ï¼š** `constexpr` å‡½æ•°åœ¨ç¼–è¯‘æ—¶å¯ä»¥è¢«è®¡ç®—ï¼Œ**ä¹Ÿå¯ä»¥åœ¨è¿è¡Œæ—¶ä½¿ç”¨**ï¼ˆå¦‚æœä¼ å…¥çš„å‚æ•°æ˜¯è¿è¡Œæ—¶å˜é‡ï¼‰ã€‚

------



#### constå’Œ constexprç»“åˆ

å¯ä»¥å°† `constexpr` **è¿”å›çš„å€¼èµ‹ç»™ `const` å˜é‡**ï¼š

```cpp
constexpr int getVal() { return 100; }

int main() {
    const int a = getVal();  // âœ… å…è®¸
    constexpr int b = getVal();  // âœ… å…è®¸
}
```

ä½†å¦‚æœ `getVal()` **ä¸æ˜¯ `constexpr` å‡½æ•°**ï¼Œé‚£ä¹ˆ `constexpr int b = getVal();` **ä¼šæŠ¥é”™**ã€‚



#### æ€»ç»“

- `const` å˜é‡åœ¨ è¿è¡Œæ—¶åˆå§‹åŒ–ï¼Œä¸èƒ½ä¿®æ”¹ï¼Œä½†å¯ä»¥ä¾èµ–è¿è¡Œæ—¶å˜é‡ã€‚
- `constexpr` å˜é‡å¿…é¡»åœ¨ç¼–è¯‘æ—¶åˆå§‹åŒ–ï¼Œé€‚ç”¨äº æ•°ç»„å¤§å°ã€æ¨¡æ¿å‚æ•°ã€ç¼–è¯‘æœŸä¼˜åŒ–ã€‚
- `constexpr` å‡½æ•° å¯ä»¥ åœ¨ç¼–è¯‘æ—¶è®¡ç®—ï¼Œä¹Ÿå¯ä»¥ åœ¨è¿è¡Œæ—¶ä½¿ç”¨ã€‚
- `constexpr` æ›´å¼ºå¤§ï¼Œä½†ä½¿ç”¨æ—¶è¦ç¡®ä¿å€¼å¯åœ¨ç¼–è¯‘æœŸç¡®å®šã€‚



### å‰ç½®++ä¸åç½®++

- å‰ç½® `++`ï¼ˆ`++obj`ï¼‰ï¼šè¿”å›è‡ªå¢åçš„å¯¹è±¡ã€‚
- åç½® `++`ï¼ˆ`obj++`ï¼‰ï¼šéœ€è¦ä¸€ä¸ª int å½¢å‚ä½œä¸ºåŒºåˆ†ï¼Œå¹¶è¿”å›è‡ªå¢å‰çš„å¯¹è±¡ã€‚

```cpp
#include <iostream>

class Counter {
private:
    int value;
public:
    Counter(int v) : value(v) {}

    // å‰ç½®++ (prefix increment)
    Counter& operator++() {
        ++value;    // å…ˆè‡ªå¢
        return *this; // è¿”å›è‡ªå¢åçš„å¯¹è±¡ï¼ˆå¼•ç”¨ï¼‰
    }

    // åç½®++ (postfix increment)
    const Counter operator++(int) { // æ³¨æ„è¿™é‡Œçš„ int å‚æ•°
        Counter temp = *this; // å…ˆä¿å­˜å½“å‰çŠ¶æ€
        ++value;   // è‡ªå¢
        return temp; // è¿”å›åŸå§‹å€¼
    }

    void print() const {
        std::cout << "Value: " << value << std::endl;
    }
};

int main() {
    Counter c(5);

    ++c;   // è°ƒç”¨å‰ç½®++
    c.print(); // Value: 6

    c++;   // è°ƒç”¨åç½®++
    c.print(); // Value: 7

    return 0;
}
```

 1ã€ä¸ºä»€ä¹ˆåç½®è¿”å›å¯¹è±¡ï¼Œâ½½ä¸æ˜¯å¼•â½¤ 

å› ä¸ºåç½®ä¸ºäº†è¿”å›æ—§å€¼åˆ›å»ºäº†â¼€ä¸ªä¸´æ—¶å¯¹è±¡ï¼Œåœ¨å‡½æ•°ç»“æŸçš„æ—¶å€™è¿™ä¸ªå¯¹è±¡å°±ä¼šè¢«é”€æ¯ï¼Œå¦‚æœè¿”å›å¼•â½¤ï¼Œé‚£ä¹ˆæˆ‘è¯·é—® ä½ ï¼Ÿä½ çš„å¯¹è±¡å¯¹è±¡éƒ½è¢«é”€æ¯äº†ï¼Œä½ å¼•â½¤å•¥å‘¢ï¼Ÿ 

2ã€ä¸ºä»€ä¹ˆåç½®å‰â¾¯ä¹Ÿè¦åŠ const 

å…¶å®ä¹Ÿå¯ä»¥ä¸åŠ ï¼Œä½†æ˜¯ä¸ºäº†é˜²â½Œä½ ä½¿â½¤i++++,è¿ç»­ä¸¤æ¬¡çš„è°ƒâ½¤åç½®++é‡è½½ç¬¦ï¼Œä¸ºä»€ä¹ˆå‘¢? åŸå› ï¼š å®ƒä¸å†…ç½®ç±»å‹â¾ä¸ºä¸â¼€è‡´ï¼›ä½ â½†æ³•æ´»å¾—ä½ æ‰€æœŸæœ›çš„ç»“æœï¼Œå› ä¸ºç¬¬â¼€æ¬¡è¿”å›çš„æ˜¯æ—§å€¼ï¼Œâ½½ä¸æ˜¯åŸå¯¹è±¡ï¼Œä½ è°ƒâ½¤ä¸¤æ¬¡å ç½®++ï¼Œç»“æœåªç´¯åŠ äº†â¼€æ¬¡ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»â¼¿åŠ¨ç¦â½Œå…¶åˆæ³•åŒ–ï¼Œå°±è¦åœ¨å‰â¾¯åŠ ä¸Šconstã€‚ 

3ã€å¤„ç†â½¤æˆ·çš„â¾ƒå®šä¹‰ç±»å‹ æœ€å¥½ä½¿â½¤å‰ç½®++ï¼Œå› ä¸ºä»–ä¸ä¼šåˆ›å»ºä¸´æ—¶å¯¹è±¡ï¼Œè¿›â½½ä¸ä¼šå¸¦æ¥æ„é€ å’Œææ„â½½é€ æˆçš„æ ¼å¤–å¼€é”€ã€‚



### å‡½æ•°æŒ‡é’ˆ

```cpp
#include <iostream>

// å®šä¹‰ä¸€ä¸ªæ™®é€šå‡½æ•°
int add(int a, int b) {
    return a + b;
}

int main() {
    // å£°æ˜å‡½æ•°æŒ‡é’ˆï¼ˆæŒ‡å‘è¿”å›å€¼ä¸º intï¼Œå‚æ•°ä¸º (int, int) çš„å‡½æ•°ï¼‰
    int (*funcPtr)(int, int);

    // èµ‹å€¼ï¼ˆå°† add å‡½æ•°çš„åœ°å€èµ‹ç»™ funcPtrï¼‰
    funcPtr = add;

    // é€šè¿‡å‡½æ•°æŒ‡é’ˆè°ƒç”¨å‡½æ•°
    std::cout << "Result: " << funcPtr(3, 5) << std::endl;  // è¾“å‡º 8

    return 0;
}

```

#### è¦ç‚¹

1. **å‡½æ•°æŒ‡é’ˆçš„å£°æ˜æ ¼å¼**ï¼š

   ```cpp
   è¿”å›ç±»å‹ (*æŒ‡é’ˆå˜é‡å)(å‚æ•°ç±»å‹);
   ```

   ä¾‹å¦‚ï¼š`int (*funcPtr)(int, int);`

2. **èµ‹å€¼æ—¶å¯ä»¥çœç•¥ `&`**ï¼Œå³ `funcPtr = add;` ç­‰ä»·äº `funcPtr = &add;`

3. **è°ƒç”¨æ–¹å¼**ï¼š

   - `funcPtr(3, 5);`  âœ…ï¼ˆæ¨èï¼‰
   - `(*funcPtr)(3, 5);`  âœ…ï¼ˆç­‰ä»·ï¼‰



#### åº”ç”¨

**ï¼ˆ1ï¼‰å‡½æ•°æŒ‡é’ˆä½œä¸ºå‚æ•°ï¼ˆå›è°ƒå‡½æ•°ï¼‰**

å‡½æ•°æŒ‡é’ˆå¯ä»¥ä½œä¸ºå‚æ•°ä¼ é€’ï¼Œä½¿å‡½æ•°çš„è¡Œä¸ºæ›´åŠ çµæ´»ã€‚

```cpp
#include <iostream>

// å®šä¹‰ä¸¤ä¸ªè¿ç®—å‡½æ•°
int add(int a, int b) { return a + b; }
int multiply(int a, int b) { return a * b; }

// è®¡ç®—å‡½æ•°ï¼Œæ¥æ”¶ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆä½œä¸ºå‚æ•°
int calculate(int x, int y, int (*operation)(int, int)) {
    return operation(x, y);  // è°ƒç”¨ä¼ å…¥çš„å‡½æ•°
}

int main() {
    std::cout << "Add: " << calculate(4, 5, add) << std::endl;         // 9
    std::cout << "Multiply: " << calculate(4, 5, multiply) << std::endl; // 20
    return 0;
}
```

ğŸ“Œ **ä¼˜ç‚¹**ï¼š

- **`calculate`** å‡½æ•°å¯ä»¥ä½¿ç”¨ä¸åŒçš„è¿ç®—å‡½æ•°ï¼Œæé«˜ä»£ç å¤ç”¨æ€§ã€‚
- **å›è°ƒå‡½æ•°**ï¼šé€‚ç”¨äºæ’åºã€è‡ªå®šä¹‰æ“ä½œç­‰åœºæ™¯ã€‚

------

**ï¼ˆ2ï¼‰æ•°ç»„ + å‡½æ•°æŒ‡é’ˆï¼ˆå‡½æ•°è¡¨/è·³è½¬è¡¨ï¼‰**

å¯ä»¥ç”¨å‡½æ•°æŒ‡é’ˆæ•°ç»„åˆ›å»º**å‡½æ•°è¡¨**ï¼Œè®©ç¨‹åºåŠ¨æ€é€‰æ‹©è¦æ‰§è¡Œçš„å‡½æ•°ã€‚

```cpp
include <iostream>

// å®šä¹‰ä¸‰ä¸ªæ“ä½œå‡½æ•°
int add(int a, int b) { return a + b; }
int subtract(int a, int b) { return a - b; }
int multiply(int a, int b) { return a * b; }

int main() {
    // å‡½æ•°æŒ‡é’ˆæ•°ç»„
    int (*operations[])(int, int) = {add, subtract, multiply};

    // é€‰æ‹©è¿ç®—æ–¹å¼
    int choice = 2;  // 0 = add, 1 = subtract, 2 = multiply

    std::cout << "Result: " << operations[choice](10, 5) << std::endl;  // 50 (è°ƒç”¨ multiply)
    
    return 0;
}
```

ğŸ“Œ **ä¼˜åŠ¿**ï¼š

- **ç±»ä¼¼ `switch` è¯­å¥ï¼Œä½†æ›´çµæ´»**ï¼Œå¯ä»¥åŠ¨æ€æ‰©å±•ã€‚
- **å¸¸ç”¨äºå‘½ä»¤è§£æã€èœå•ç³»ç»Ÿã€äº‹ä»¶å›è°ƒç­‰**ã€‚

------

**ï¼ˆ3ï¼‰æŒ‡å‘æˆå‘˜å‡½æ•°çš„æŒ‡é’ˆ**

C++ å…è®¸å‡½æ•°æŒ‡é’ˆæŒ‡å‘**ç±»çš„æˆå‘˜å‡½æ•°**ï¼Œä½†**æˆå‘˜å‡½æ•°æŒ‡é’ˆçš„è¯­æ³•ä¸åŒ**ï¼š

```cpp
#include <iostream>

class Calculator {
public:
    int add(int a, int b) { return a + b; }
};

int main() {
    Calculator obj;
    
    // å®šä¹‰æˆå‘˜å‡½æ•°æŒ‡é’ˆ
    int (Calculator::*funcPtr)(int, int) = &Calculator::add;

    // é€šè¿‡å¯¹è±¡è°ƒç”¨æˆå‘˜å‡½æ•°æŒ‡é’ˆ
    std::cout << "Result: " << (obj.*funcPtr)(3, 7) << std::endl;  // 10
    
    // é€šè¿‡æŒ‡é’ˆè°ƒç”¨
    Calculator* pObj = &obj;
    std::cout << "Result: " << (pObj->*funcPtr)(3, 7) << std::endl;  // 10

    return 0;
}
```

ğŸ“Œ **è¦ç‚¹**ï¼š

- **æˆå‘˜å‡½æ•°æŒ‡é’ˆçš„å®šä¹‰**ï¼š

  ```cpp
  è¿”å›ç±»å‹ (ç±»å::*æŒ‡é’ˆå˜é‡)(å‚æ•°åˆ—è¡¨) = &ç±»å::æˆå‘˜å‡½æ•°;
  ```

- **è°ƒç”¨æ–¹å¼**ï¼š

  - `å¯¹è±¡.*æŒ‡é’ˆ(å‚æ•°);`
  - `å¯¹è±¡æŒ‡é’ˆ->*æŒ‡é’ˆ(å‚æ•°);`
  - **è°ƒç”¨æˆå‘˜å‡½æ•°æŒ‡é’ˆæ—¶ï¼Œ`.\*` å’Œ `->\*` æ˜¯å¿…é¡»çš„**ï¼Œä¸èƒ½çœç•¥ `*` å·

------

**ï¼ˆ4ï¼‰ä½¿ç”¨ `std::function` ä»£æ›¿å‡½æ•°æŒ‡é’ˆï¼ˆC++11+ï¼‰**

C++11 æä¾›äº† `std::function`ï¼Œå¯ä»¥å­˜å‚¨æ™®é€šå‡½æ•°ã€lambdaã€æˆå‘˜å‡½æ•°ç­‰ï¼Œå¯è¯»æ€§æ›´å¥½ã€‚

```cpp
#include <iostream>
#include <functional>  // å¼•å…¥ std::function

int add(int a, int b) { return a + b; }

int main() {
    std::function<int(int, int)> funcPtr = add;
    
    std::cout << "Result: " << funcPtr(4, 6) << std::endl;  // 10
    return 0;
}
```

ğŸ“Œ **ä¼˜åŠ¿**ï¼š

- å¯ä»¥å­˜å‚¨**æ™®é€šå‡½æ•°ã€lambda è¡¨è¾¾å¼ã€æˆå‘˜å‡½æ•°**ç­‰ã€‚
- æ›´åŠ **çµæ´»å’Œå®‰å…¨**ï¼Œé¿å…å‡½æ•°æŒ‡é’ˆçš„å¤æ‚è¯­æ³•ã€‚



### å¼ºåˆ¶ç±»å‹è½¬æ¢

åœ¨ C++ ä¸­ï¼Œæä¾›äº† 4 ç§ç±»å‹è½¬æ¢å…³é”®å­—ï¼Œåˆ†åˆ«æ˜¯ `static_cast`ã€`dynamic_cast`ã€`reinterpret_cast` å’Œ `const_cast`ã€‚ç›¸æ¯” C è¯­è¨€çš„å¼ºåˆ¶è½¬æ¢ï¼ˆ`(type)value`ï¼‰ï¼ŒC++ çš„è¿™ 4 ç§è½¬æ¢æ–¹å¼æä¾›äº†æ›´å¼ºçš„**ç±»å‹å®‰å…¨æ€§**å’Œ**å¯è¯»æ€§**ã€‚



#### 1. `static_cast`ï¼ˆé™æ€è½¬æ¢ï¼‰

`static_cast` ä¸»è¦ç”¨äº**ç¼–è¯‘æœŸå¯ä»¥ç¡®å®šçš„è½¬æ¢**ï¼Œæ¯”å¦‚åŸºæœ¬ç±»å‹è½¬æ¢ã€çˆ¶å­ç±»æŒ‡é’ˆè½¬æ¢ï¼ˆéè™šå‡½æ•°çš„æƒ…å†µï¼‰ã€‚

âœ… **åŸºæœ¬æ•°æ®ç±»å‹è½¬æ¢** âœ… **å­ç±»æŒ‡é’ˆ â†’ çˆ¶ç±»æŒ‡é’ˆ** âœ… **çˆ¶ç±»æŒ‡é’ˆ â†’ å­ç±»æŒ‡é’ˆï¼ˆä¸å®‰å…¨ï¼Œéœ€å¼€å‘è€…ä¿è¯æ­£ç¡®æ€§ï¼‰** âœ… **void\* æŒ‡é’ˆè½¬æ¢ä¸ºå…·ä½“ç±»å‹æŒ‡é’ˆ**

```cpp
#include <iostream>

class Base {};
class Derived : public Base {};

int main() {
    // åŸºæœ¬ç±»å‹è½¬æ¢
    double d = 3.14;
    int i = static_cast<int>(d);  // âœ… è½¬æ¢ double â†’ int
    std::cout << "i = " << i << std::endl;

    // å­ç±»æŒ‡é’ˆè½¬æ¢ä¸ºçˆ¶ç±»æŒ‡é’ˆï¼ˆå®‰å…¨ï¼‰
    Derived dObj;
    Base* basePtr = static_cast<Base*>(&dObj);  // âœ… å­ç±» â†’ çˆ¶ç±»

    // çˆ¶ç±»æŒ‡é’ˆè½¬æ¢ä¸ºå­ç±»æŒ‡é’ˆï¼ˆä¸å®‰å…¨ï¼Œéœ€ä¿è¯æ˜¯æ­£ç¡®çš„å­ç±»å¯¹è±¡ï¼‰
    Base* bPtr = new Derived();
    Derived* dPtr = static_cast<Derived*>(bPtr);  // â—ä¸æ£€æŸ¥å®‰å…¨æ€§ï¼Œéœ€å¼€å‘è€…ä¿è¯ bPtr æŒ‡å‘ Derived

    return 0;
}
```

ğŸ“Œ **æ³¨æ„**ï¼š

- `static_cast` **ä¸ä¼šæ‰§è¡Œè¿è¡Œæ—¶æ£€æŸ¥**ï¼Œå¦‚æœ `bPtr` æŒ‡å‘çš„å¯¹è±¡ä¸æ˜¯ `Derived`ï¼Œè½¬æ¢ä¼šå¯¼è‡´**æœªå®šä¹‰è¡Œä¸º**ï¼ˆUBï¼‰ã€‚
- ä¸èƒ½ç”¨äºä¸åŒç±»å‹å¯¹è±¡ä¹‹é—´çš„è½¬æ¢ï¼Œæ¯”å¦‚ `Base` â†’ `int`ï¼Œè¿™ä¼šå¯¼è‡´ç¼–è¯‘é”™è¯¯ã€‚



#### 2. `dynamic_cast`ï¼ˆåŠ¨æ€è½¬æ¢ï¼‰

`dynamic_cast` ä¸»è¦ç”¨äº**å«æœ‰è™šå‡½æ•°çš„å¤šæ€ç±»ä¹‹é—´çš„å®‰å…¨è½¬æ¢**ï¼Œä¾èµ– **RTTIï¼ˆè¿è¡Œæ—¶ç±»å‹è¯†åˆ«ï¼‰**ã€‚

âœ… **çˆ¶ç±»æŒ‡é’ˆï¼ˆæˆ–å¼•ç”¨ï¼‰ â†’ å­ç±»æŒ‡é’ˆï¼ˆæˆ–å¼•ç”¨ï¼‰** âœ… **å¿…é¡»æ˜¯å¤šæ€ç±»ï¼ˆåŸºç±»è¦æœ‰è™šå‡½æ•°ï¼‰** âœ… **è½¬æ¢å¤±è´¥æ—¶ï¼ŒæŒ‡é’ˆè¿”å› `nullptr`ï¼Œå¼•ç”¨æŠ› `std::bad_cast` å¼‚å¸¸**

```cpp
#include <iostream>
#include <typeinfo>

class Base {
public:
    virtual void show() {}  // å¿…é¡»æœ‰è™šå‡½æ•°ï¼Œä¿è¯æ˜¯å¤šæ€ç±»
};

class Derived : public Base {};

class OtherClass {};

int main() {
    Base* basePtr = new Derived();
    Derived* derivedPtr = dynamic_cast<Derived*>(basePtr);  // âœ… å®‰å…¨è½¬æ¢

    if (derivedPtr) {
        std::cout << "Conversion successful!" << std::endl;
    } else {
        std::cout << "Conversion failed!" << std::endl;
    }

    // é”™è¯¯è½¬æ¢ï¼ˆè½¬æ¢å¤±è´¥ï¼Œè¿”å› nullptrï¼‰
    Base* basePtr2 = new Base();
    Derived* derivedPtr2 = dynamic_cast<Derived*>(basePtr2);  // âŒ å¤±è´¥ï¼ŒbasePtr2 æŒ‡å‘çš„æ˜¯ Base
    if (!derivedPtr2) {
        std::cout << "Conversion failed!" << std::endl;
    }

    return 0;
}
```

ğŸ“Œ **æ³¨æ„**ï¼š

- `Base` å¿…é¡»æ˜¯**å¤šæ€ç±»**ï¼ˆæœ‰è‡³å°‘ä¸€ä¸ª `virtual` å‡½æ•°ï¼‰ã€‚

- ```
  dynamic_cast
  ```

  æœ‰è¿è¡Œæ—¶ç±»å‹æ£€æŸ¥ï¼Œå¦‚æœè½¬æ¢å¤±è´¥ï¼š

  - **æŒ‡é’ˆ** è¿”å› `nullptr`
  - **å¼•ç”¨** æŠ› `std::bad_cast` å¼‚å¸¸

- æ¯” `static_cast` **æ›´å®‰å…¨ï¼Œä½†æœ‰æ€§èƒ½æŸè€—**ï¼Œå› ä¸ºå®ƒä¾èµ– RTTIã€‚



#### 3. `reinterpret_cast`ï¼ˆé‡æ–°è§£é‡Šè½¬æ¢ï¼‰

`reinterpret_cast` ç”¨äº**å‡ ä¹ä»»æ„ç±»å‹ä¹‹é—´çš„è½¬æ¢**ï¼Œä¸ä¼šæ£€æŸ¥å®‰å…¨æ€§ã€‚

âœ… **æŒ‡é’ˆç±»å‹é—´è½¬æ¢ï¼ˆå¦‚ `int\*` â†” `char\*`ï¼‰** âœ… **æ•´æ•° â†” æŒ‡é’ˆ** âœ… **å‡½æ•°æŒ‡é’ˆè½¬æ¢** âŒ **ä¸è¦ç”¨äºç±»å±‚æ¬¡ç»“æ„ä¹‹é—´çš„è½¬æ¢ï¼ˆ`Base` â†” `Derived`ï¼‰ï¼Œå¯èƒ½å¯¼è‡´ UB**

```cpp
#include <iostream>

int main() {
    int a = 65;
    char* c = reinterpret_cast<char*>(&a);  // âœ… int* â†’ char*
    std::cout << "Char value: " << *c << std::endl;  // å¯èƒ½è¾“å‡º 'A'ï¼ˆASCII 65ï¼‰

    // int è½¬æŒ‡é’ˆ
    int* ptr = reinterpret_cast<int*>(0x12345678);
    std::cout << "ptr: " << ptr << std::endl;  // å¯èƒ½å¯¼è‡´ UB

    return 0;
}
```

ğŸ“Œ **æ³¨æ„**ï¼š

- `reinterpret_cast` **ä¸ä¼šè¿›è¡Œç±»å‹æ£€æŸ¥**ï¼Œå®Œå…¨æ˜¯**äºŒè¿›åˆ¶çº§åˆ«**çš„è½¬æ¢ã€‚
- å¯èƒ½å¯¼è‡´**æœªå®šä¹‰è¡Œä¸ºï¼ˆUBï¼‰**ï¼Œéœ€å¼€å‘è€…ç¡®ä¿åˆç†ä½¿ç”¨ã€‚



#### 4. `const_cast`ï¼ˆå»é™¤ `const` é™å®šï¼‰

`const_cast` ä¸»è¦ç”¨äº**å»é™¤ `const` æˆ– `volatile` ä¿®é¥°**ï¼Œä½¿å¾—å¯ä¿®æ”¹å¸¸é‡ã€‚

âœ… **å»é™¤ `const`ï¼Œè®©åŸæœ¬ `const` å¯¹è±¡å¯ä¿®æ”¹** âœ… ==**å¸¸ç”¨äºéœ€è¦ä¿®æ”¹ `const` å‚æ•°çš„æ—§ API**== âŒ **ä¸èƒ½ç”¨äº `const` å˜é‡çš„ç›´æ¥ä¿®æ”¹ï¼Œå¦åˆ™ UB**

```cpp
#include <iostream>

void modify(const int* ptr) {
    int* modifiable = const_cast<int*>(ptr);  // âœ… å»æ‰ const
    *modifiable = 100;
}

int main() {
    int x = 10;
    modify(&x);
    std::cout << "Modified x: " << x << std::endl;  // âœ… è¾“å‡º 100

    // âŒ é”™è¯¯ç”¨æ³•ï¼ˆä¿®æ”¹çœŸæ­£çš„å¸¸é‡ï¼ŒUBï¼‰
    const int y = 20;
    int* p = const_cast<int*>(&y);
    *p = 30;  // âŒ UBï¼Œä¸è¦ä¿®æ”¹ const å˜é‡

    return 0;
}
```

ğŸ“Œ **æ³¨æ„**ï¼š

- `const_cast` **åªèƒ½ç§»é™¤ `const`ï¼Œä¸èƒ½ç”¨äºç±»å‹è½¬æ¢**ã€‚
- **å¦‚æœ `const` å˜é‡å­˜æ”¾åœ¨åªè¯»å†…å­˜åŒºï¼Œä¿®æ”¹å®ƒå¯èƒ½ä¼šå¯¼è‡´å´©æºƒï¼ˆUBï¼‰**ã€‚



#### 5. æ€»ç»“

| ç±»å‹               | ç”¨é€”                       | è¿è¡Œæ—¶æ£€æŸ¥ | å®‰å…¨æ€§     | å…¸å‹ç”¨æ³•                                   |
| ------------------ | -------------------------- | ---------- | ---------- | ------------------------------------------ |
| `static_cast`      | ç¼–è¯‘æœŸå¯ç¡®å®šçš„è½¬æ¢         | âŒ æ—        | âš ï¸ ç›¸å¯¹å®‰å…¨ | åŸºæœ¬ç±»å‹ã€çˆ¶å­ç±»æŒ‡é’ˆè½¬æ¢                   |
| `dynamic_cast`     | å¤šæ€ç±»å‹è½¬æ¢               | âœ… æœ‰       | âœ… é«˜å®‰å…¨æ€§ | è¿è¡Œæ—¶æ£€æŸ¥ RTTIï¼Œå®‰å…¨è½¬æ¢çˆ¶ç±» â†” å­ç±»       |
| `reinterpret_cast` | ä»»æ„ç±»å‹è½¬æ¢               | âŒ æ—        | âŒ ä¸å®‰å…¨   | æŒ‡é’ˆç±»å‹ã€æ•´æ•° â†” æŒ‡é’ˆã€å‡½æ•°æŒ‡é’ˆè½¬æ¢        |
| `const_cast`       | ç§»é™¤ `const/volatile` ä¿®é¥° | âŒ æ—        | âš ï¸ å¯èƒ½ UB  | ä¿®æ”¹ `const` å˜é‡ï¼ˆä»…ç”¨äºé `const` å˜é‡ï¼‰ |

ğŸ“Œ **æœ€ä½³å®è·µ**

- âœ… **ä¼˜å…ˆä½¿ç”¨ `static_cast`ï¼Œé¿å… `reinterpret_cast`**
- âœ… **å¤šæ€ç±»å‹è½¬æ¢åº”ä½¿ç”¨ `dynamic_cast`**
- âœ… **å°½é‡é¿å… `const_cast` ä¿®æ”¹ `const` å˜é‡**

è¿™ 4 ç§è½¬æ¢æ–¹å¼æ¯” C é£æ ¼çš„ `(T)value` æ›´å®‰å…¨ã€å¯è¯»æ€§æ›´å¥½ï¼Œèƒ½å¸®åŠ©å¼€å‘è€…æ›´æ¸…æ™°åœ°ç®¡ç†ç±»å‹è½¬æ¢ï¼



### cppå†…å­˜ç®¡ç†

C++ å†…å­˜å¤§è‡´åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªåŒºåŸŸï¼š

| **å†…å­˜åŒºåŸŸ**                    | **ç‰¹ç‚¹**             | **å…¸å‹å†…å®¹**                                                 |
| ------------------------------- | -------------------- | ------------------------------------------------------------ |
| **æ ˆï¼ˆStackï¼‰**                 | ç”±ç³»ç»Ÿè‡ªåŠ¨åˆ†é…å’Œé‡Šæ”¾ | ==å±€éƒ¨å˜é‡ã€å‡½æ•°å‚æ•°ã€è¿”å›åœ°å€==                             |
| **å †ï¼ˆHeapï¼‰**                  | ç”±ç¨‹åºå‘˜åˆ†é…å’Œé‡Šæ”¾   | `new`/`malloc` åˆ›å»ºçš„åŠ¨æ€å¯¹è±¡ï¼Œç¨‹åºå‘˜æ‰‹åŠ¨åˆ†é…å’Œé‡Šæ”¾          |
| **é™æ€å­˜å‚¨åŒºï¼ˆStatic/Globalï¼‰** | ç¨‹åºå¼€å§‹åˆ°ç»“æŸ       | `static` å˜é‡ã€å…¨å±€å˜é‡ã€å¸¸é‡å­—ç¬¦ä¸²ï¼Œç¨‹åºè¿è¡ŒæœŸé—´ä¸€ç›´å­˜åœ¨ï¼Œç›´åˆ°ç¨‹åºç»“æŸã€‚**è‡ªåŠ¨åˆå§‹åŒ–**ï¼Œå…¨å±€å˜é‡å’Œ `static` å˜é‡é»˜è®¤åˆå§‹åŒ–ä¸º 0ã€‚ |
| **ä»£ç æ®µï¼ˆCode Segmentï¼‰**      | åªè¯»ã€å­˜æ”¾å¯æ‰§è¡Œä»£ç  | å¯æ‰§è¡Œç¨‹åºæŒ‡ä»¤ï¼Œ**åªè¯»**ï¼Œé˜²æ­¢ç¨‹åºæ„å¤–ä¿®æ”¹ä»£ç                |



### æ™ºèƒ½æŒ‡é’ˆ

æ™ºèƒ½æŒ‡é’ˆï¼ˆSmart Pointerï¼‰æ˜¯ C++ æ ‡å‡†åº“æä¾›çš„ **è‡ªåŠ¨ç®¡ç†å†…å­˜** çš„æŒ‡é’ˆå¯¹è±¡ï¼Œèƒ½å¤Ÿåœ¨ä¸éœ€è¦æ—¶ **è‡ªåŠ¨é‡Šæ”¾å†…å­˜**ï¼Œä»è€Œé˜²æ­¢å†…å­˜æ³„æ¼å’Œæ‚¬æµ®æŒ‡é’ˆé—®é¢˜ã€‚

C++ æ ‡å‡†åº“æä¾›äº† ä¸‰ç§ä¸»è¦çš„æ™ºèƒ½æŒ‡é’ˆï¼ˆä½äº `<memory>` å¤´æ–‡ä»¶ä¸­ï¼‰ï¼š

- `std::unique_ptr`ï¼ˆç‹¬å æ‰€æœ‰æƒï¼‰
- `std::shared_ptr`ï¼ˆå¼•ç”¨è®¡æ•°å…±äº«ï¼‰
- `std::weak_ptr`ï¼ˆå¼±å¼•ç”¨ï¼Œé¿å…å¾ªç¯å¼•ç”¨ï¼‰



#### `std::unique_ptr`ï¼ˆç‹¬å æ‰€æœ‰æƒï¼‰

- **ç‰¹ç‚¹**
  - **å”¯ä¸€æ‰€æœ‰æƒ**ï¼š`unique_ptr` åªèƒ½æœ‰ä¸€ä¸ªæ™ºèƒ½æŒ‡é’ˆç®¡ç†åŒä¸€ä¸ªå¯¹è±¡ï¼Œä¸èƒ½å…±äº«ã€‚
  - **è‡ªåŠ¨é‡Šæ”¾**ï¼š`unique_ptr` åœ¨ç¦»å¼€ä½œç”¨åŸŸæ—¶è‡ªåŠ¨é‡Šæ”¾å†…å­˜ã€‚
  - **ä¸å¯å¤åˆ¶**ï¼Œä½†**å¯ä»¥ç§»åŠ¨**ï¼ˆ`std::move`ï¼‰ã€‚
- **ç¤ºä¾‹**

```cpp
#include <iostream>
#include <memory>

class Test {
public:
    Test() { std::cout << "Constructor\n"; }
    ~Test() { std::cout << "Destructor\n"; }
};

int main() {
    std::unique_ptr<Test> ptr1 = std::make_unique<Test>();  // âœ… åˆ›å»ºå¯¹è±¡
    // std::unique_ptr<Test> ptr2 = ptr1;  âŒ é”™è¯¯ï¼Œunique_ptr ä¸èƒ½å¤åˆ¶

    std::unique_ptr<Test> ptr2 = std::move(ptr1);  // âœ… è½¬ç§»æ‰€æœ‰æƒ
    if (!ptr1) std::cout << "ptr1 is now nullptr\n";

    return 0;
}  // âœ… ptr2 ç¦»å¼€ä½œç”¨åŸŸï¼Œè‡ªåŠ¨é‡Šæ”¾å¯¹è±¡
```

- `std::make_unique<T>()` æ¨èç”¨æ³•

  - `std::make_unique<T>()` **æ¯” `new` æ›´å®‰å…¨**ï¼Œå¯ä»¥é˜²æ­¢å¼‚å¸¸æ—¶çš„å†…å­˜æ³„æ¼ï¼š

  ```cpp
  std::unique_ptr<int> p = std::make_unique<int>(10);  // âœ… æ¨è
  ```

  è€Œ 

  ```
  std::unique_ptr<int> p(new int(10));
  ```

   å¯èƒ½å¯¼è‡´å¼‚å¸¸æ—¶å†…å­˜æ³„æ¼ã€‚



####  `std::shared_ptr`ï¼ˆå¼•ç”¨è®¡æ•°å…±äº«ï¼‰

- **ç‰¹ç‚¹**
  - **å¤šä¸ª `shared_ptr` å¯ä»¥å…±äº«åŒä¸€å¯¹è±¡**ï¼Œä½¿ç”¨**å¼•ç”¨è®¡æ•°**ï¼ˆReference Countingï¼‰ã€‚
  - **å½“æœ€åä¸€ä¸ª `shared_ptr` ç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼Œè‡ªåŠ¨é‡Šæ”¾å¯¹è±¡**ã€‚
  - **é€‚ç”¨äºå¤šä¸ªå¯¹è±¡å…±äº«èµ„æºçš„æƒ…å†µ**ã€‚
- **ç¤ºä¾‹**

```cpp
#include <iostream>
#include <memory>

class Test {
public:
    Test() { std::cout << "Constructor\n"; }
    ~Test() { std::cout << "Destructor\n"; }
};

int main() {
    std::shared_ptr<Test> ptr1 = std::make_shared<Test>();  // âœ… å…±äº«æ‰€æœ‰æƒ
    std::shared_ptr<Test> ptr2 = ptr1;  // âœ… å¼•ç”¨è®¡æ•° +1

    std::cout << "Reference count: " << ptr1.use_count() << "\n";  // è¾“å‡º 2
    ptr1.reset();  // âœ… é‡Šæ”¾ ptr1ï¼Œå¼•ç”¨è®¡æ•° -1
    std::cout << "Reference count: " << ptr2.use_count() << "\n";  // è¾“å‡º 1

    return 0;
}  // âœ… ptr2 ç¦»å¼€ä½œç”¨åŸŸï¼Œå¼•ç”¨è®¡æ•°å˜ 0ï¼Œé‡Šæ”¾å¯¹è±¡
```

- `std::make_shared<T>()` æ¨èç”¨æ³•

  ```cpp
  std::shared_ptr<int> p = std::make_shared<int>(10);  // âœ… æ¨è
  ```

  ```
  std::make_shared<T>()
  ```

  å‡å°‘äº†é¢å¤–çš„å†…å­˜åˆ†é…ï¼Œæ¯” 

  ```
  new
  ```

   æ›´é«˜æ•ˆã€‚



#### `std::weak_ptr`ï¼ˆå¼±å¼•ç”¨ï¼Œé¿å…å¾ªç¯å¼•ç”¨ï¼‰

- **ç‰¹ç‚¹**
  - `weak_ptr` **ä¸ä¼šå¢åŠ å¼•ç”¨è®¡æ•°**ï¼Œåªå¯¹ `shared_ptr` è¿›è¡Œ**éæ‹¥æœ‰æ€§å¼•ç”¨**ã€‚
  - **ç”¨äºé¿å… `shared_ptr` å¾ªç¯å¼•ç”¨**ï¼ˆæ¯”å¦‚ `std::shared_ptr<A>` å’Œ `std::shared_ptr<B>` äº’ç›¸æŒæœ‰å¯¹æ–¹ï¼‰ã€‚
  - `weak_ptr` **ä¸èƒ½ç›´æ¥ä½¿ç”¨**ï¼Œéœ€è¦ä½¿ç”¨ `.lock()` è½¬æ¢ä¸º `shared_ptr`ã€‚
- **ç¤ºä¾‹ï¼ˆé¿å…å¾ªç¯å¼•ç”¨ï¼‰**

```cpp
#include <iostream>
#include <memory>

class B;  // å‰å‘å£°æ˜

class A {
public:
    std::shared_ptr<B> b_ptr;
    ~A() { std::cout << "A destroyed\n"; }
};

class B {
public:
    std::weak_ptr<A> a_ptr;  // â—ï¸ä½¿ç”¨ weak_ptr è§£å†³å¾ªç¯å¼•ç”¨
    ~B() { std::cout << "B destroyed\n"; }
};

int main() {
    std::shared_ptr<A> a = std::make_shared<A>();
    std::shared_ptr<B> b = std::make_shared<B>();

    a->b_ptr = b;
    b->a_ptr = a;  // âœ… ä½¿ç”¨ weak_ptrï¼Œé¿å…å¾ªç¯å¼•ç”¨

    return 0;  // âœ… ç”±äº weak_ptrï¼Œä¸ä¼šå¯¼è‡´å†…å­˜æ³„æ¼
}
```

ğŸ“Œ **å¦‚æœ `B` ä¹Ÿä½¿ç”¨ `shared_ptr<A>`ï¼Œå¯¹è±¡ä¸ä¼šé‡Šæ”¾ï¼Œå¯¼è‡´** **å†…å­˜æ³„æ¼ï¼ˆå¾ªç¯å¼•ç”¨ï¼‰**ï¼



#### æ™ºèƒ½æŒ‡é’ˆ VS åŸå§‹æŒ‡é’ˆ

| **æ¯”è¾ƒé¡¹**   | **æ™ºèƒ½æŒ‡é’ˆï¼ˆSmart Pointerï¼‰**        | **åŸå§‹æŒ‡é’ˆï¼ˆRaw Pointerï¼‰** |
| ------------ | ------------------------------------ | --------------------------- |
| **æ‰€æœ‰æƒ**   | `unique_ptr` ç‹¬å , `shared_ptr` å…±äº« | ä»…å­˜å‚¨åœ°å€ï¼Œæ— æ‰€æœ‰æƒ        |
| **ç”Ÿå‘½å‘¨æœŸ** | **è‡ªåŠ¨é‡Šæ”¾å†…å­˜**                     | éœ€æ‰‹åŠ¨ `delete`             |
| **å¼‚å¸¸å®‰å…¨** | **å®‰å…¨**ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼               | å¯èƒ½æ³„æ¼                    |
| **å¼•ç”¨è®¡æ•°** | `shared_ptr` æœ‰å¼•ç”¨è®¡æ•°              | æ—                           |
| **å¾ªç¯å¼•ç”¨** | å¯èƒ½å­˜åœ¨ï¼Œä½† `weak_ptr` å¯è§£å†³       | ä¸å­˜åœ¨                      |



#### ä»€ä¹ˆæ—¶å€™ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆï¼Ÿ

| **åœºæ™¯**              | **æ¨èæ™ºèƒ½æŒ‡é’ˆ**                                   |
| --------------------- | -------------------------------------------------- |
| ç‹¬å æ‰€æœ‰æƒ            | `std::unique_ptr<T>`                               |
| å…±äº«æ‰€æœ‰æƒ            | `std::shared_ptr<T>`                               |
| é¿å…å¾ªç¯å¼•ç”¨          | `std::weak_ptr<T>`                                 |
| èµ„æºç®¡ç†              | `std::unique_ptr<T>`ï¼ˆæ–‡ä»¶ã€Socketã€æ•°æ®åº“è¿æ¥ç­‰ï¼‰ |
| é¿å…æ‰‹åŠ¨ `new/delete` | `std::make_unique<T>()` / `std::make_shared<T>()`  |



#### æ€»ç»“

1. `std::unique_ptr`ï¼ˆ**ç‹¬å æ‰€æœ‰æƒ**ï¼‰â€”â€” **ä¸å…è®¸æ‹·è´ï¼Œå¯ç§»åŠ¨**ï¼Œç”Ÿå‘½å‘¨æœŸç»“æŸæ—¶è‡ªåŠ¨é‡Šæ”¾ã€‚
2. `std::shared_ptr`ï¼ˆ**å¼•ç”¨è®¡æ•°**ï¼‰â€”â€” **å¤šä¸ªæŒ‡é’ˆå…±äº«èµ„æº**ï¼Œæœ€åä¸€ä¸ªæŒ‡é’ˆé‡Šæ”¾èµ„æºã€‚
3. `std::weak_ptr`ï¼ˆ**å¼±å¼•ç”¨**ï¼‰â€”â€” **ä¸å½±å“å¼•ç”¨è®¡æ•°**ï¼Œ**è§£å†³ `shared_ptr` å¾ªç¯å¼•ç”¨é—®é¢˜**ã€‚
4. **æ¨èä½¿ç”¨ `std::make_unique<T>()` å’Œ `std::make_shared<T>()` åˆ›å»ºæ™ºèƒ½æŒ‡é’ˆ**ï¼Œæ¯” `new` æ›´å®‰å…¨é«˜æ•ˆã€‚

ğŸ’¡ **å»ºè®®å§‹ç»ˆä¼˜å…ˆä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆï¼Œé¿å…æ‰‹åŠ¨ `new/delete`ï¼Œæé«˜ä»£ç çš„å®‰å…¨æ€§å’Œå¯ç»´æŠ¤æ€§ï¼** ğŸš€



### cppé¢å‘å¯¹è±¡

ä¸‰å¤§ç‰¹å¾ï¼šç»§æ‰¿ã€å°è£…ã€å¤šæ€ï¼ˆè¦†ç›–ã€é‡è½½ï¼‰

è®¿é—®ä¿®é¥°ç¬¦ï¼šprivateã€publicã€protected

#### å¤šé‡ç»§æ‰¿

ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ `virtual` ç»§æ‰¿ï¼Ÿ

- å½“å¤šä¸ªåŸºç±»ç»§æ‰¿åŒä¸€ä¸ªåŸºç±»ï¼Œå¹¶ä¸”æ´¾ç”Ÿç±»åˆå¤šé‡ç»§æ‰¿è¿™äº›åŸºç±»æ—¶ï¼Œåº”è¯¥ä½¿ç”¨ `virtual` ç»§æ‰¿ã€‚
- é˜²æ­¢â€œè±å½¢ç»§æ‰¿â€å¯¼è‡´çš„å¤šä»½åŸºç±»å®ä¾‹é—®é¢˜ã€‚

```cpp
#include <iostream>

class A {
public:
    int value;
    A(int v) : value(v) { std::cout << "A constructed\n"; }
};

class B : virtual public A {
public:
    B() : A(20) { std::cout << "B constructed\n"; }
};

class C : virtual public A {
public:
    C() : A(30) { std::cout << "C constructed\n"; }
};

class D : public B, public C {
public:
    D() : A(40) { std::cout << "D constructed\n"; }
};

int main() {
    D d;
    std::cout << "A::value in D: " << d.value << std::endl;
    return 0;
}
```

```css
A constructed   âœ… ç”± D æ„é€  A
B constructed
C constructed
D constructed
A::value in D: 40
```



#### å¤šæ€å®ç°

**å¤šæ€ï¼ˆPolymorphismï¼‰** æ˜¯ C++ é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼ˆOOPï¼‰çš„ä¸‰å¤§ç‰¹æ€§ä¹‹ä¸€ï¼ˆå°è£…ã€ç»§æ‰¿ã€å¤šæ€ï¼‰ã€‚å®ƒå…è®¸ **çˆ¶ç±»æŒ‡é’ˆæˆ–å¼•ç”¨** è°ƒç”¨ **å­ç±»çš„é‡å†™æ–¹æ³•**ï¼Œä»è€Œå®ç° **åŠ¨æ€ç»‘å®šï¼ˆDynamic Bindingï¼‰**ã€‚

**å¤šæ€çš„æ ¸å¿ƒæœºåˆ¶ï¼š**

1. **è™šå‡½æ•°ï¼ˆVirtual Functionï¼‰**
2. **è™šå‡½æ•°è¡¨ï¼ˆVirtual Table, vtableï¼‰**
3. **è™šæŒ‡é’ˆï¼ˆvptrï¼‰**



**ç¤ºä¾‹ï¼šä¸ä½¿ç”¨è™šå‡½æ•°ï¼ˆé™æ€ç»‘å®šï¼‰**

```cpp
#include <iostream>

class Base {
public:
    void show() { std::cout << "Base::show()" << std::endl; }
};

class Derived : public Base {
public:
    void show() { std::cout << "Derived::show()" << std::endl; }
};

int main() {
    Base* ptr = new Derived();
    ptr->show();  // è¾“å‡ºï¼šBase::show()  âŒ å‘ç”Ÿé™æ€ç»‘å®šï¼Œè°ƒç”¨çš„æ˜¯ Base ç‰ˆæœ¬
    delete ptr;
    return 0;
}
```

**âŒ `ptr->show()` è°ƒç”¨çš„æ˜¯ `Base::show()`ï¼Œè€Œä¸æ˜¯ `Derived::show()`ã€‚**
 **åŸå› **ï¼š

- `show()` **ä¸æ˜¯è™šå‡½æ•°**ï¼ŒC++ **ç¼–è¯‘æ—¶ï¼ˆç¼–è¯‘æœŸï¼‰å†³å®šè°ƒç”¨å“ªä¸ªç‰ˆæœ¬ï¼ˆé™æ€ç»‘å®šï¼‰**ã€‚
- **è°ƒç”¨çš„æ˜¯æŒ‡é’ˆçš„ç±»å‹ `Base\*` çš„å‡½æ•°ï¼Œè€Œä¸æ˜¯ `Derived` ç‰ˆæœ¬ã€‚**



**ä½¿ç”¨è™šå‡½æ•°å®ç°å¤šæ€ï¼ˆåŠ¨æ€ç»‘å®šï¼‰**

```cpp
#include <iostream>

class Base {
public:
    virtual void show() { std::cout << "Base::show()" << std::endl; } // è™šå‡½æ•°
};

class Derived : public Base {
public:
    void show() override { std::cout << "Derived::show()" << std::endl; } // é‡å†™
};

int main() {
    Base* ptr = new Derived();
    ptr->show();  // âœ… è¾“å‡ºï¼šDerived::show()  ï¼ˆåŠ¨æ€ç»‘å®šï¼‰
    delete ptr;
    return 0;
}
```

- `Base::show()` æ˜¯ **è™šå‡½æ•°**ï¼ŒC++ **åœ¨è¿è¡Œæ—¶å†³å®šè°ƒç”¨å“ªä¸€ä¸ªç‰ˆæœ¬**ï¼ˆåŠ¨æ€ç»‘å®šï¼‰ã€‚
- `ptr` æŒ‡å‘ `Derived` å¯¹è±¡ï¼Œå› æ­¤ `ptr->show()` è°ƒç”¨ **Derived ç‰ˆæœ¬çš„ `show()`**ã€‚
- åŠ ä¸Šoverrideå…³é”®å­—å¯ä»¥æ›´å¥½åœ°å¸®åŠ©ç¼–è¯‘å™¨æ£€æŸ¥ã€‚



**vtableï¼ˆè™šå‡½æ•°è¡¨ï¼‰**

- **æ¯ä¸ªæ‹¥æœ‰è™šå‡½æ•°çš„ç±»** éƒ½ä¼šæœ‰ä¸€ä¸ª **è™šå‡½æ•°è¡¨ï¼ˆvtableï¼‰**ã€‚
- vtable æ˜¯ä¸€ä¸ª **æŒ‡é’ˆæ•°ç»„**ï¼Œ**å­˜å‚¨è¯¥ç±»çš„è™šå‡½æ•°åœ°å€**ã€‚

**vptrï¼ˆè™šæŒ‡é’ˆï¼‰**

- **æ¯ä¸ªå¯¹è±¡** éƒ½æœ‰ä¸€ä¸ª **éšè—çš„æŒ‡é’ˆï¼ˆvptrï¼‰**ï¼ŒæŒ‡å‘ **è¯¥ç±»çš„ vtable**ã€‚

```cpp
class Base {
public:
    virtual void func1() { std::cout << "Base::func1()" << std::endl; }
    virtual void func2() { std::cout << "Base::func2()" << std::endl; }
};

class Derived : public Base {
public:
    void func1() override { std::cout << "Derived::func1()" << std::endl; }
};
```

**vtable ç»“æ„**

```css
Base vtable:
+-----------------+
| Base::func1()  |
| Base::func2()  |
+-----------------+

Derived vtable:
+-----------------+
| Derived::func1()  |  (è¦†ç›– Base::func1())
| Base::func2()     |  (ç»§æ‰¿ Base::func2())
+-----------------+

å¯¹è±¡ (Derived)
+-------------------+
| vptr -> Derived vtable |
+-------------------+
```

ğŸ“Œ **Derived åªé‡å†™ `func1()`ï¼Œæ‰€ä»¥ `func2()` ä»ç„¶æŒ‡å‘ `Base::func2()`ï¼**



**çº¯è™šå‡½æ•°å’ŒæŠ½è±¡ç±»**

- **çº¯è™šå‡½æ•°æ²¡æœ‰å…·ä½“å®ç°**ï¼Œæ´¾ç”Ÿç±»**å¿…é¡»é‡å†™**å®ƒã€‚
- **æœ‰çº¯è™šå‡½æ•°çš„ç±»å«æŠ½è±¡ç±»ï¼Œä¸èƒ½å®ä¾‹åŒ–**ã€‚

```cpp
#include <iostream>

class Base {
public:
    virtual void show() = 0;  // çº¯è™šå‡½æ•°
};

class Derived : public Base {
public:
    void show() override { std::cout << "Derived::show()" << std::endl; }
};

int main() {
    // Base b; âŒ é”™è¯¯ï¼ŒæŠ½è±¡ç±»ä¸èƒ½å®ä¾‹åŒ–
    Derived d;
    d.show();  // âœ… è¾“å‡ºï¼šDerived::show()
    return 0;
}
```



**è™šææ„å‡½æ•°**

ä¸ºä»€ä¹ˆè¦è™šææ„ï¼Œä¸ºä»€ä¹ˆä¸èƒ½è™šæ„é€ ï¼Ÿ

é€šå¸¸ï¼Œå¦‚æœâ¼€ä¸ªç±»å¯èƒ½è¢«ç»§æ‰¿ï¼Œä¸”åœ¨å…¶æ´¾ç”Ÿç±»ä¸­æœ‰å¯èƒ½ä½¿ç”¨è¯¥åŸºç±»çš„ææ„å‡½æ•°åº”è¯¥å£°æ˜ä¸ºè™šææ„å‡½æ•°ã€‚

- å¦‚æœåŸºç±»çš„ææ„å‡½æ•°ä¸æ˜¯è™šå‡½æ•°ï¼Œå½“**ä½¿ç”¨åŸºç±»æŒ‡é’ˆåˆ é™¤å­ç±»å¯¹è±¡æ—¶**ï¼Œåªä¼šè°ƒç”¨åŸºç±»çš„ææ„å‡½æ•°ï¼Œè€Œä¸ä¼šè°ƒç”¨å­ç±»çš„ææ„å‡½æ•°ï¼Œå¯¼è‡´å­ç±»çš„èµ„æºæ²¡æœ‰æ­£ç¡®é‡Šæ”¾ã€‚
- æ„é€ å‡½æ•°ä¸èƒ½æ˜¯è™šçš„ï¼Œå› ä¸ºæ„é€ æ—¶è¿˜æ²¡æœ‰ vtableï¼Œæ— æ³•é€šè¿‡è™šè¡¨æ‰¾åˆ°æ­£ç¡®çš„æ„é€ å‡½æ•°ã€‚

**å¦‚æœåŸºç±»çš„ææ„å‡½æ•°æ˜¯è™šå‡½æ•°**ï¼Œåˆ™åœ¨åˆ é™¤å¯¹è±¡æ—¶ï¼Œä¼š**å…ˆè°ƒç”¨å­ç±»çš„ææ„å‡½æ•°ï¼Œå†è°ƒç”¨åŸºç±»çš„ææ„å‡½æ•°**ï¼Œç¡®ä¿èµ„æºæ­£ç¡®é‡Šæ”¾ã€‚

```cpp
#include <iostream>

class Base {
public:
    Base() { std::cout << "Base Constructor\n"; }
    virtual ~Base() { std::cout << "Base Destructor\n"; }  // âœ… è®¾ä¸ºè™šå‡½æ•°
};

class Derived : public Base {
public:
    Derived() { std::cout << "Derived Constructor\n"; }
    ~Derived() { std::cout << "Derived Destructor\n"; }  // ç°åœ¨ä¼šè¢«æ­£ç¡®è°ƒç”¨
};

int main() {
    Base* obj = new Derived();  // åŸºç±»æŒ‡é’ˆæŒ‡å‘å­ç±»å¯¹è±¡
    delete obj;  // âœ… å…ˆè°ƒç”¨ Derived ææ„å‡½æ•°ï¼Œå†è°ƒç”¨ Base ææ„å‡½æ•°
}
```

```css
Base Constructor
Derived Constructor
Derived Destructor
Base Destructor
```

âœ… **ç»“æœ**ï¼š

- **å…ˆè°ƒç”¨å­ç±» `Derived` çš„ææ„å‡½æ•°ï¼Œå†è°ƒç”¨åŸºç±» `Base` çš„ææ„å‡½æ•°**ï¼Œç¡®ä¿èµ„æºæ­£ç¡®é‡Šæ”¾ã€‚

å“ªäº›å‡½æ•°ä¸èƒ½è¢«å£°æ˜ä¸ºè™šå‡½æ•°ï¼šæ„é€ å‡½æ•°ã€æ™®é€šå‡½æ•°ã€é™æ€æˆå‘˜å‡½æ•°ã€å‹å…ƒå‡½æ•°ã€å†…è”æˆå‘˜å‡½æ•°ã€‚



#### å‹å…ƒ

**å‹å…ƒå‡½æ•°**

- å…è®¸ä¸€ä¸ªæ™®é€šå‡½æ•°è®¿é—®ç±»çš„ç§æœ‰æˆå‘˜ã€‚
- è¯¥å‡½æ•°ä¸æ˜¯ç±»çš„æˆå‘˜ï¼Œä½†å¯ä»¥è®¿é—®ç±»çš„ç§æœ‰æ•°æ®ã€‚

```cpp
#include <iostream>
using namespace std;

class A {
private:
    int x;

public:
    A(int val) : x(val) {}

    // å‹å…ƒå‡½æ•°å£°æ˜
    friend void show(const A& obj);
};

// å‹å…ƒå‡½æ•°å®šä¹‰
//å¸¸å¼•ç”¨ï¼ˆconst &ï¼‰ æ˜¯ C++ ä¸­çš„ä¸€ç§ç‰¹æ®Šçš„å¼•ç”¨ç±»å‹ï¼Œå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯ é˜²æ­¢è¢«å¼•ç”¨çš„å€¼è¢«ä¿®æ”¹ï¼Œæé«˜ç¨‹åºçš„å®‰å…¨æ€§å’Œå¯è¯»æ€§ã€‚
void show(const A& obj) {
    cout << "Private x = " << obj.x << endl;  // âœ… å¯ä»¥è®¿é—®ç§æœ‰å˜é‡ x
}

int main() {
    A a(10);
    show(a);  // è°ƒç”¨å‹å…ƒå‡½æ•°
    return 0;
}

```

**å‹å…ƒç±»**

- å…è®¸ä¸€ä¸ªç±»è®¿é—®å¦ä¸€ä¸ªç±»çš„ç§æœ‰å’Œä¿æŠ¤æˆå‘˜ã€‚
- é€‚ç”¨äºä¸¤ä¸ªç±»å…³ç³»ç´§å¯†ï¼Œä½†ä¸å¸Œæœ›æŠŠæ•°æ®æš´éœ²ç»™æ‰€æœ‰ç±»çš„æƒ…å†µã€‚

```cpp
#include <iostream>
using namespace std;

class B;  // å…ˆå£°æ˜ç±» Bï¼Œé¿å…é”™è¯¯

class A {
private:
    int x;

public:
    A(int val) : x(val) {}

    // å‹å…ƒç±»å£°æ˜
    friend class B;  
};

class B {
public:
    void show(const A& obj) {
        cout << "Accessing private x from class A: " << obj.x << endl;  // âœ… è®¿é—®ç§æœ‰å˜é‡
    }
};

int main() {
    A a(20);
    B b;
    b.show(a);  // é€šè¿‡ B è®¿é—® A çš„ç§æœ‰æˆå‘˜
    return 0;
}

```

**å‹å…ƒæˆå‘˜å‡½æ•°**

- åªè®©å¦ä¸€ä¸ªç±»çš„æŸä¸ªç‰¹å®šæˆå‘˜å‡½æ•°è®¿é—®ç§æœ‰æ•°æ®ï¼Œè€Œä¸æ˜¯æ•´ä¸ªç±»ã€‚
- æ¯”å‹å…ƒç±»çš„æƒé™æ›´å°ï¼Œæ›´ç¬¦åˆå°è£…æ€§ã€‚

```cpp
#include <iostream>
using namespace std;

class A {
private:
    int x;

public:
    A(int val) : x(val) {}

    // è®© B çš„ `show()` æˆå‘˜å‡½æ•°æˆä¸ºå‹å…ƒ
    friend void B::show(const A& obj);
};

class B {
public:
    void show(const A& obj) {
        cout << "B accessing A's private x: " << obj.x << endl;  // âœ… è®¿é—® A çš„ç§æœ‰æˆå‘˜
    }
};

int main() {
    A a(30);
    B b;
    b.show(a);
    return 0;
}

```

**å¸¸è§åº”ç”¨ï¼šé‡è½½`<<`æ“ä½œç¬¦**

å¯¹`operator<<`å‡½æ•°è¿›è¡Œé‡è½½ï¼ŒåŸæœ¬æ˜¯ä¸€ä¸ªå…¨å±€å‡½æ•°ï¼ˆéæˆå‘˜å‡½æ•°ï¼‰ï¼Œå¦‚æœæ²¡æœ‰ç‰¹æ®Šçš„æœºåˆ¶ï¼Œå®ƒä¸èƒ½ç›´æ¥è®¿é—®ç±»çš„ç§æœ‰æˆå‘˜

```cpp
#include <iostream>
using namespace std;

class A {
private:
    int x;

public:
    A(int val) : x(val) {}

    // å‹å…ƒå‡½æ•°å£°æ˜
    friend ostream& operator<<(ostream& os, const A& obj);
};

// å‹å…ƒå‡½æ•°å®šä¹‰
ostream& operator<<(ostream& os, const A& obj) {
    os << "x = " << obj.x;  // âœ… è®¿é—®ç§æœ‰æˆå‘˜
    return os;
}

int main() {
    A a(100);
    cout << a << endl;  // âœ… å‹å…ƒå‡½æ•°é‡è½½ <<ï¼Œå¯ä»¥ç›´æ¥æ‰“å°ç§æœ‰æˆå‘˜
    return 0;
}
```





#### æ‹·è´æ„é€ å‡½æ•°

æ‹·è´æ„é€ å‡½æ•°çš„å®šä¹‰æ ¼å¼ï¼š

```cpp
ClassName(const ClassName& other);
```

- **`const ClassName& other`**ï¼šå‚æ•°æ˜¯å¯¹å·²æœ‰å¯¹è±¡çš„**å¸¸å¼•ç”¨**ï¼Œé¿å…æ— æ„ä¹‰çš„é€’å½’æ‹·è´ã€‚
- å¦‚æœæ˜¯`ClassName(const ClassName other)`ï¼Œotherä¼ é€’æ—¶è¦åˆ›å»ºä¸€ä¸ªä¸´æ—¶å¯¹è±¡ï¼Œåˆ™å†æ¬¡è°ƒç”¨æ‹·è´æ„é€ å‡½æ•°å¯¼è‡´æ— é™é€’å½’ã€‚
- **ä¸è¿”å›å€¼**ï¼Œå› ä¸ºå®ƒæ˜¯æ„é€ å‡½æ•°ã€‚



**æµ…æ‹·è´ï¼ˆé»˜è®¤æ‹·è´æ„é€ å‡½æ•°ï¼‰**

- é»˜è®¤æ‹·è´æ„é€ å‡½æ•° è¿›è¡Œ â€œæŒ‰ä½å¤åˆ¶â€ï¼Œå¦‚æœå¯¹è±¡åŒ…å«æŒ‡é’ˆæˆå‘˜ï¼Œå¯èƒ½å¯¼è‡´é‡å¤é‡Šæ”¾åŒä¸€å—å†…å­˜ï¼ˆæ‚¬ç©ºæŒ‡é’ˆé—®é¢˜ï¼‰ã€‚

**æ·±æ‹·è´ï¼ˆè‡ªå®šä¹‰æ‹·è´æ„é€ å‡½æ•°ï¼‰**

- æ·±æ‹·è´ï¼ˆDeep Copyï¼‰ éœ€è¦åˆ†é…æ–°å†…å­˜ï¼Œç¡®ä¿æ¯ä¸ªå¯¹è±¡æœ‰è‡ªå·±çš„å‰¯æœ¬ã€‚

å¦‚æœä¸å¸Œæœ›å¯¹è±¡è¢«æ‹·è´ï¼Œä½¿ç”¨ `= delete`ï¼Œæˆ–è€…ä½¿ç”¨ `std::unique_ptr` ä»£æ›¿åŸå§‹æŒ‡é’ˆã€‚





## cpp STL



### ç®€ä»‹

C++ çš„ **STLï¼ˆStandard Template Libraryï¼Œæ ‡å‡†æ¨¡æ¿åº“ï¼‰** æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ä¸”é«˜æ•ˆçš„åº“ï¼Œå®ƒæä¾›äº†ä¸€ç³»åˆ—é€šç”¨ç®—æ³•å’Œæ•°æ®ç»“æ„ï¼Œä½¿ C++ ç¼–ç¨‹æ›´åŠ ç®€æ´å’Œé«˜æ•ˆã€‚STL ä¸»è¦ç”±ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ç»„æˆï¼š

------

**1. å®¹å™¨ï¼ˆContainersï¼‰**

å®¹å™¨æ˜¯ STL ä¸­ç”¨äºå­˜å‚¨æ•°æ®çš„æ•°æ®ç»“æ„ï¼Œæ ¹æ®åº•å±‚å®ç°å¯åˆ†ä¸º **åºåˆ—å¼å®¹å™¨** å’Œ **å…³è”å¼å®¹å™¨**ã€‚

**ï¼ˆ1ï¼‰åºåˆ—å¼å®¹å™¨**

åºåˆ—å¼å®¹å™¨ï¼ˆSequential Containersï¼‰æŒ‰ç…§å…ƒç´ çš„æ’å…¥é¡ºåºå­˜å‚¨æ•°æ®ï¼š

- `vector<T>`ï¼šåŠ¨æ€æ•°ç»„ï¼Œæ”¯æŒå¿«é€Ÿéšæœºè®¿é—®ï¼Œé€‚åˆé¢‘ç¹è¯»å–æ“ä½œã€‚
- `deque<T>`ï¼šåŒç«¯é˜Ÿåˆ—ï¼Œæ”¯æŒå¤´å°¾å¿«é€Ÿæ’å…¥å’Œåˆ é™¤ã€‚
- `list<T>`ï¼šåŒå‘é“¾è¡¨ï¼Œé€‚åˆé¢‘ç¹çš„æ’å…¥ã€åˆ é™¤æ“ä½œï¼ˆä¸­é—´ä½ç½®ï¼‰ã€‚
- `forward_list<T>`ï¼šå•å‘é“¾è¡¨ï¼Œå†…å­˜å ç”¨æ›´å°‘ï¼Œä½†åªæ”¯æŒå•å‘éå†ã€‚
- `array<T, N>`ï¼šå›ºå®šå¤§å°çš„æ•°ç»„ï¼Œå°è£…äº†æ™®é€š C++ æ•°ç»„çš„åŠŸèƒ½ã€‚
- `string`ï¼šä¸“é—¨ç”¨äºå­˜å‚¨å’Œæ“ä½œå­—ç¬¦ä¸²çš„ç±»ã€‚

**ï¼ˆ2ï¼‰å…³è”å¼å®¹å™¨**

å…³è”å¼å®¹å™¨ï¼ˆAssociative Containersï¼‰é‡‡ç”¨ **å¹³è¡¡äºŒå‰æœç´¢æ ‘ï¼ˆå¦‚çº¢é»‘æ ‘ï¼‰** è¿›è¡Œå­˜å‚¨ï¼Œæ”¯æŒé«˜æ•ˆçš„æŸ¥æ‰¾ã€æ’å…¥ã€åˆ é™¤æ“ä½œï¼š

- `set<T>`ï¼šé›†åˆï¼Œä¸å…è®¸é‡å¤å…ƒç´ ï¼Œå…ƒç´ é»˜è®¤æŒ‰ **å‡åº** æ’åºã€‚
- `multiset<T>`ï¼šå…è®¸é‡å¤å…ƒç´ çš„é›†åˆã€‚
- `map<K, V>`ï¼šé”®å€¼å¯¹ï¼ˆæ˜ å°„ï¼‰ï¼Œä¸å…è®¸é‡å¤é”®ï¼ŒæŒ‰ **é”®å‡åº** æ’åºã€‚
- `multimap<K, V>`ï¼šå…è®¸é‡å¤é”®çš„æ˜ å°„ã€‚

**ï¼ˆ3ï¼‰æ— åºå®¹å™¨**

æ— åºå®¹å™¨ï¼ˆUnordered Containersï¼‰åŸºäº **å“ˆå¸Œè¡¨ï¼ˆhash tableï¼‰** å®ç°ï¼ŒæŸ¥æ‰¾é€Ÿåº¦æ›´å¿«ï¼ˆO(1) å¹³å‡æ—¶é—´å¤æ‚åº¦ï¼‰ï¼š

- `unordered_set<T>`ï¼šæ— åºé›†åˆï¼Œä¸å…è®¸é‡å¤å…ƒç´ ã€‚
- `unordered_multiset<T>`ï¼šæ— åºé›†åˆï¼Œå…è®¸é‡å¤å…ƒç´ ã€‚
- `unordered_map<K, V>`ï¼šæ— åºæ˜ å°„ï¼Œä¸å…è®¸é‡å¤é”®ã€‚
- `unordered_multimap<K, V>`ï¼šæ— åºæ˜ å°„ï¼Œå…è®¸é‡å¤é”®ã€‚

------

**2. è¿­ä»£å™¨ï¼ˆIteratorsï¼‰**

è¿­ä»£å™¨ç”¨äºéå† STL å®¹å™¨ä¸­çš„å…ƒç´ ï¼Œç±»ä¼¼æŒ‡é’ˆï¼Œå¯ä»¥æ”¯æŒä¸åŒçš„éå†æ–¹å¼ï¼š

- **è¾“å…¥è¿­ä»£å™¨**ï¼ˆInput Iteratorï¼‰ï¼šåªèƒ½ä»å¤´åˆ°å°¾å•å‘è¯»å–ï¼Œå¦‚ `istream_iterator`ã€‚
- **è¾“å‡ºè¿­ä»£å™¨**ï¼ˆOutput Iteratorï¼‰ï¼šåªèƒ½å‘å®¹å™¨å†™å…¥æ•°æ®ï¼Œå¦‚ `ostream_iterator`ã€‚
- **å‰å‘è¿­ä»£å™¨**ï¼ˆForward Iteratorï¼‰ï¼šæ”¯æŒå•å‘éå†ï¼Œèƒ½å¤šæ¬¡è¯»å–ç›¸åŒå…ƒç´ ï¼Œå¦‚ `forward_list`ã€‚
- **åŒå‘è¿­ä»£å™¨**ï¼ˆBidirectional Iteratorï¼‰ï¼šæ”¯æŒåŒå‘éå†ï¼Œå¦‚ `list`ã€`set`ã€‚
- **éšæœºè®¿é—®è¿­ä»£å™¨**ï¼ˆRandom Access Iteratorï¼‰ï¼šæ”¯æŒç±»ä¼¼æ•°ç»„çš„éšæœºè®¿é—®ï¼Œå¦‚ `vector`ã€`deque`ã€‚

------

**3. ç®—æ³•ï¼ˆAlgorithmsï¼‰**

STL æä¾›äº†å¤§é‡çš„é€šç”¨ç®—æ³•ï¼Œå¦‚ï¼š

- **æ’åº**ï¼š`sort()`ã€`stable_sort()`ã€‚
- **æŸ¥æ‰¾**ï¼š`find()`ã€`binary_search()`ã€‚
- **å˜æ¢**ï¼š`transform()`ã€‚
- **è®¡æ•°**ï¼š`count()`ã€‚
- **åˆ é™¤/æ›¿æ¢**ï¼š`remove()`ã€`replace()`ã€‚
- **åˆå¹¶/åˆ†å‰²**ï¼š`merge()`ã€`partition()`ã€‚

ç¤ºä¾‹ï¼š

```cpp
#include <iostream>
#include <vector>
#include <algorithm>

int main() {
    std::vector<int> vec = {5, 2, 8, 1, 9};
    std::sort(vec.begin(), vec.end());  // å‡åºæ’åº

    for (int num : vec) {
        std::cout << num << " ";
    }
    return 0;
}
```

------

**4. ä»¿å‡½æ•°ï¼ˆFunctorsï¼‰**

ä»¿å‡½æ•°ï¼ˆå‡½æ•°å¯¹è±¡ï¼‰æ˜¯é‡è½½ `operator()` çš„ç±»æˆ–ç»“æ„ä½“ï¼Œä¸»è¦ç”¨äºå®šåˆ¶ STL ç®—æ³•ï¼š

```cpp
#include <iostream>
#include <vector>
#include <algorithm>

struct Compare {
    bool operator()(int a, int b) { return a > b; }  // é™åº
};

int main() {
    std::vector<int> vec = {5, 2, 8, 1, 9};
    std::sort(vec.begin(), vec.end(), Compare());

    for (int num : vec) {
        std::cout << num << " ";
    }
    return 0;
}
```

------

**5. é€‚é…å™¨ï¼ˆAdaptersï¼‰**

é€‚é…å™¨æ˜¯å¯¹å·²æœ‰ STL ç»„ä»¶çš„å°è£…ï¼Œä½¿å…¶è¡Œä¸ºå‘ç”Ÿå˜åŒ–ï¼š

- **å®¹å™¨é€‚é…å™¨**ï¼š`stack`ã€`queue`ã€`priority_queue`ã€‚
- **è¿­ä»£å™¨é€‚é…å™¨**ï¼š`reverse_iterator`ã€`insert_iterator`ã€‚
- **å‡½æ•°é€‚é…å™¨**ï¼š`bind()`ã€`not1()`ã€`not2()`ã€‚

ç¤ºä¾‹ï¼š

```cpp
#include <iostream>
#include <stack>

int main() {
    std::stack<int> s;
    s.push(10);
    s.push(20);
    s.push(30);

    while (!s.empty()) {
        std::cout << s.top() << " ";  // 30 20 10
        s.pop();
    }
    return 0;
}
```



### vector

`vector` æ˜¯ C++ STLï¼ˆæ ‡å‡†æ¨¡æ¿åº“ï¼‰ä¸­æœ€å¸¸ç”¨çš„ **åºåˆ—å¼å®¹å™¨**ï¼Œå®ƒå®ç°äº† **åŠ¨æ€æ•°ç»„**ï¼Œæ”¯æŒé«˜æ•ˆçš„ **éšæœºè®¿é—®** å’Œ **è‡ªåŠ¨æ‰©å®¹**ï¼Œéå¸¸é€‚åˆå­˜å‚¨å’Œæ“ä½œè¿ç»­å­˜å‚¨çš„æ•°æ®ã€‚

------

#### **1. `vector` çš„ç‰¹ç‚¹**

- **åŠ¨æ€æ‰©å±•**ï¼š`vector` ä¼šåœ¨å®¹é‡ä¸è¶³æ—¶è‡ªåŠ¨æ‰©å±•ï¼Œé€šå¸¸æ˜¯ **2 å€å¢é•¿**ã€‚
- **è¿ç»­å­˜å‚¨**ï¼šåº•å±‚å®ç°æ˜¯ **åŠ¨æ€æ•°ç»„**ï¼Œæ‰€æœ‰å…ƒç´ éƒ½å­˜å‚¨åœ¨ **è¿ç»­çš„å†…å­˜å—** ä¸­ï¼Œå› æ­¤å¯ä»¥åƒæ™®é€šæ•°ç»„ä¸€æ ·é€šè¿‡ç´¢å¼•è®¿é—®å…ƒç´ ã€‚
- **å¿«é€Ÿéšæœºè®¿é—®**ï¼šæ”¯æŒ **O(1)** æ—¶é—´å¤æ‚åº¦çš„éšæœºè®¿é—®ï¼Œå³ `vec[i]`ã€‚
- **æ”¯æŒå¢åˆ æ”¹æŸ¥**ï¼š
  - åœ¨ **æœ«å°¾æ’å…¥ã€åˆ é™¤** å…ƒç´ ï¼ˆ`push_back()`ã€`pop_back()`ï¼‰é€Ÿåº¦å¿«ï¼ˆO(1)ï¼‰ã€‚
  - **ä¸­é—´æ’å…¥ã€åˆ é™¤** éœ€è¦ **ç§»åŠ¨æ•°æ®**ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯ O(n)ã€‚
- **å¯ä¸æ ‡å‡†ç®—æ³•å…¼å®¹**ï¼šæ”¯æŒ STL ç®—æ³•ï¼Œå¦‚ `sort()`ã€`find()` ç­‰ã€‚

------

#### **2. `vector` çš„å¸¸è§æ“ä½œ**

##### **ï¼ˆ1ï¼‰å®šä¹‰å’Œåˆå§‹åŒ–**

```cpp
#include <iostream>
#include <vector>
using namespace std;

int main() {
    vector<int> vec1;               // é»˜è®¤æ„é€ ç©º vector
    vector<int> vec2(5);            // 5 ä¸ªå…ƒç´ ï¼Œé»˜è®¤åˆå§‹åŒ–ä¸º 0
    vector<int> vec3(5, 10);        // 5 ä¸ªå…ƒç´ ï¼Œæ¯ä¸ªå€¼éƒ½æ˜¯ 10
    vector<int> vec4 = {1, 2, 3};   // åˆ—è¡¨åˆå§‹åŒ–
    vector<int> vec5(vec4);         // æ‹·è´æ„é€ 

    return 0;
}
```

------

##### **ï¼ˆ2ï¼‰åŸºæœ¬æ“ä½œ**

| æ“ä½œ             | æ–¹æ³•                 | è¯´æ˜                   |
| ---------------- | -------------------- | ---------------------- |
| **å¢**           | `push_back(x)`       | æœ«å°¾æ·»åŠ å…ƒç´            |
| **æ’**           | `insert(it, x)`      | åœ¨æŒ‡å®šä½ç½®æ’å…¥         |
| **åˆ **           | `pop_back()`         | åˆ é™¤æœ«å°¾å…ƒç´            |
| **åˆ **           | `erase(it)`          | åˆ é™¤æŒ‡å®šä½ç½®å…ƒç´        |
| **æ”¹**           | `vec[i] = x`         | ä¿®æ”¹æŒ‡å®šä½ç½®å…ƒç´        |
| **æŸ¥**           | `vec[i]`             | è®¿é—®å…ƒç´                |
| **æŸ¥**           | `at(i)`              | å®‰å…¨è®¿é—®ï¼ˆå¸¦è¾¹ç•Œæ£€æŸ¥ï¼‰ |
| **å¤§å°**         | `size()`             | è·å–å…ƒç´ ä¸ªæ•°           |
| **å®¹é‡**         | `capacity()`         | è·å–å½“å‰å®¹é‡           |
| **æ¸…ç©º**         | `clear()`            | æ¸…ç©ºæ‰€æœ‰å…ƒç´            |
| **åˆ¤æ–­æ˜¯å¦ä¸ºç©º** | `empty()`            | è¿”å› `true` æˆ– `false` |
| **å‰åå…ƒç´ **     | `front()` / `back()` | è®¿é—®é¦–/å°¾å…ƒç´           |

ç¤ºä¾‹ï¼š

```cpp
#include <iostream>
#include <vector>
using namespace std;

int main() {
    vector<int> vec = {1, 2, 3, 4, 5};

    vec.push_back(6);      // æ·»åŠ å…ƒç´  6
    vec.insert(vec.begin(), 0);  // åœ¨å¤´éƒ¨æ’å…¥ 0

    vec.pop_back();        // åˆ é™¤æœ«å°¾å…ƒç´  6
    vec.erase(vec.begin()); // åˆ é™¤ç¬¬ä¸€ä¸ªå…ƒç´  0

    for (int num : vec) {
        cout << num << " ";  // è¾“å‡º 1 2 3 4
    }

    return 0;
}
```

------

##### **ï¼ˆ3ï¼‰éå† `vector`**

**æ–¹æ³• 1ï¼šæ™®é€š `for` å¾ªç¯**

```cpp
for (size_t i = 0; i < vec.size(); ++i) {
    cout << vec[i] << " ";
}
```

**æ–¹æ³• 2ï¼šèŒƒå›´ `for` å¾ªç¯**

```cpp
for (int num : vec) {
    cout << num << " ";
}
```

**æ–¹æ³• 3ï¼šè¿­ä»£å™¨**

```cpp
for (vector<int>::iterator it = vec.begin(); it != vec.end(); ++it) {
    cout << *it << " ";
}
```

**æ–¹æ³• 4ï¼šC++11 `auto` å…³é”®å­—**

```cpp
for (auto it = vec.begin(); it != vec.end(); ++it) {
    cout << *it << " ";
}
```

------

##### **ï¼ˆ4ï¼‰å®¹é‡ç®¡ç†**

```cpp
vector<int> vec;
vec.reserve(100);   // é¢„åˆ†é… 100 ä¸ªç©ºé—´ï¼Œé¿å…é¢‘ç¹æ‰©å®¹
vec.shrink_to_fit(); // é‡Šæ”¾å¤šä½™çš„å†…å­˜
```

------

#### **3. `vector` çš„æ‰©å®¹æœºåˆ¶**

- `vector` åœ¨ç©ºé—´ä¸è¶³æ—¶ä¼š **è‡ªåŠ¨æ‰©å±•**ï¼Œé€šå¸¸æ˜¯ **åŸå®¹é‡çš„ 2 å€**ã€‚
- `capacity()` è¿”å›å½“å‰åˆ†é…çš„æ€»å®¹é‡ï¼Œè€Œ `size()` ä»…è¿”å›å·²å­˜å‚¨çš„å…ƒç´ ä¸ªæ•°ã€‚

ç¤ºä¾‹ï¼š

```cpp
#include <iostream>
#include <vector>
using namespace std;

int main() {
    vector<int> vec;
    for (int i = 0; i < 10; ++i) {
        vec.push_back(i);
        cout << "Size: " << vec.size() << ", Capacity: " << vec.capacity() << endl;
    }
    return 0;
}
```

**è¾“å‡ºç¤ºä¾‹ï¼ˆä¸åŒç¼–è¯‘å™¨å¯èƒ½ç•¥æœ‰ä¸åŒï¼‰ï¼š**

```
Size: 1, Capacity: 1
Size: 2, Capacity: 2
Size: 3, Capacity: 4
Size: 4, Capacity: 4
Size: 5, Capacity: 8
Size: 6, Capacity: 8
Size: 7, Capacity: 8
Size: 8, Capacity: 8
Size: 9, Capacity: 16
Size: 10, Capacity: 16
```

------

#### **4. `vector` ä¸ `array`ã€`list` çš„æ¯”è¾ƒ**

| ç‰¹æ€§              | `vector`           | `array`            | `list`         |
| ----------------- | ------------------ | ------------------ | -------------- |
| å­˜å‚¨æ–¹å¼          | **åŠ¨æ€æ•°ç»„**       | **é™æ€æ•°ç»„**       | **åŒå‘é“¾è¡¨**   |
| è®¿é—®é€Ÿåº¦          | **O(1) éšæœºè®¿é—®**  | O(1)               | O(n)           |
| æ’å…¥/åˆ é™¤ï¼ˆæœ«å°¾ï¼‰ | **O(1)**           | ä¸æ”¯æŒ             | O(1)           |
| æ’å…¥/åˆ é™¤ï¼ˆä¸­é—´ï¼‰ | **O(n)**           | O(n)               | **O(1)**       |
| è¿­ä»£å™¨            | **éšæœºè®¿é—®è¿­ä»£å™¨** | **éšæœºè®¿é—®è¿­ä»£å™¨** | **åŒå‘è¿­ä»£å™¨** |
| é€‚ç”¨åœºæ™¯          | é¢‘ç¹è®¿é—®ã€å°‘é‡æ’å…¥ | å›ºå®šå¤§å°çš„æ•°ç»„     | é¢‘ç¹æ’å…¥åˆ é™¤   |

------

#### **5. `vector` çš„å¸¸è§é—®é¢˜**



resize()ï¼šæ”¹å˜å½“å‰å®¹å™¨å†…å«æœ‰å…ƒç´ çš„æ•°é‡(size())ï¼Œâ½½ä¸æ˜¯å®¹å™¨çš„å®¹é‡

1. å½“resize(len)ä¸­len>v.capacity()ï¼Œåˆ™æ•°ç»„ä¸­çš„sizeå’Œcapacityå‡è®¾ç½®ä¸ºlen;
2. å½“resize(len)ä¸­len<=v.capacity()ï¼Œåˆ™æ•°ç»„ä¸­çš„sizeè®¾ç½®ä¸ºlenï¼Œâ½½capacityä¸å˜;   

reserve()ï¼šæ”¹å˜å½“å‰å®¹å™¨çš„æœ€â¼¤å®¹é‡ï¼ˆcapacityï¼‰

1. å¦‚æœreserve(len)çš„å€¼ > å½“å‰çš„capacity()ï¼Œé‚£ä¹ˆä¼šé‡æ–°åˆ†é…â¼€å—èƒ½å­˜lenä¸ªå¯¹è±¡çš„ç©ºé—´ï¼Œç„¶åæŠŠä¹‹å‰çš„å¯¹è±¡é€š è¿‡copy construtorå¤åˆ¶è¿‡æ¥ï¼Œé”€æ¯ä¹‹å‰çš„å†…å­˜; 
2. å½“reserve(len)ä¸­len<=å½“å‰çš„capacity()ï¼Œåˆ™æ•°ç»„ä¸­çš„capacityä¸å˜ï¼Œsizeä¸å˜ï¼Œå³ä¸å¯¹å®¹å™¨åšä»»ä½•æ”¹å˜ã€‚ 



##### **ï¼ˆ1ï¼‰å¦‚ä½•é˜²æ­¢æ‰©å®¹å½±å“æ€§èƒ½ï¼Ÿ**

å¯ä»¥ä½¿ç”¨ `reserve(n)` é¢„åˆ†é…ç©ºé—´ï¼Œé¿å…ä¸å¿…è¦çš„æ‰©å®¹ï¼š

```cpp
vector<int> vec;
vec.reserve(1000); // é¢„åˆ†é… 1000 ä¸ªå…ƒç´ çš„ç©ºé—´
```

##### **ï¼ˆ2ï¼‰å¦‚ä½•é‡Šæ”¾ `vector` å¤šä½™çš„å†…å­˜ï¼Ÿ**

ä½¿ç”¨ `shrink_to_fit()` é‡Šæ”¾æœªä½¿ç”¨çš„å®¹é‡ï¼š

```cpp
vector<int> vec(1000, 1);
vec.clear();
vec.shrink_to_fit();  // é‡Šæ”¾å¤šä½™çš„å†…å­˜
```

------

#### **æ€»ç»“**

1. `vector` æ˜¯ **åŠ¨æ€æ•°ç»„**ï¼Œæ”¯æŒ **å¿«é€Ÿéšæœºè®¿é—®ï¼ˆO(1)ï¼‰**ï¼Œä½†åœ¨ **æ’å…¥å’Œåˆ é™¤** æ—¶å¯èƒ½éœ€è¦ **ç§»åŠ¨å…ƒç´ **ï¼ˆO(n)ï¼‰ã€‚
2. æœ«å°¾æ’å…¥/åˆ é™¤æ•ˆç‡é«˜ï¼Œé€‚åˆ **å­˜å‚¨å¤§é‡è¿ç»­æ•°æ®**ã€‚
3. `vector` ä¼š **è‡ªåŠ¨æ‰©å®¹**ï¼Œä½†å¯ä»¥ä½¿ç”¨ `reserve()` é¢„åˆ†é…ç©ºé—´ä»¥ä¼˜åŒ–æ€§èƒ½ã€‚
4. **é€‚ç”¨äºé¢‘ç¹éšæœºè®¿é—®ã€ä¸å¸¸æ’å…¥/åˆ é™¤ä¸­é—´å…ƒç´ çš„åœºæ™¯**ã€‚

å¦‚æœéœ€è¦ **é«˜æ•ˆæ’å…¥/åˆ é™¤**ï¼Œå»ºè®®ä½¿ç”¨ `list`ï¼›å¦‚æœæ•°æ®å¤§å°å›ºå®šï¼Œå»ºè®®ä½¿ç”¨ `array`ã€‚





### list

`list` æ˜¯ C++ STLï¼ˆæ ‡å‡†æ¨¡æ¿åº“ï¼‰ä¸­çš„ **åŒå‘é“¾è¡¨ï¼ˆDoubly Linked Listï¼‰** å®¹å™¨ï¼Œå®ƒæ”¯æŒ **å¿«é€Ÿçš„æ’å…¥å’Œåˆ é™¤** æ“ä½œï¼Œä½†ä¸æ”¯æŒ **éšæœºè®¿é—®**ã€‚

------

#### **1. `list` çš„ç‰¹ç‚¹**

- **åŒå‘é“¾è¡¨ç»“æ„**ï¼šæ¯ä¸ªå…ƒç´ å­˜å‚¨ä¸€ä¸ªæŒ‡å‘å‰åå…ƒç´ çš„æŒ‡é’ˆï¼ˆ`prev` å’Œ `next`ï¼‰ã€‚
- **æ’å…¥å’Œåˆ é™¤æ“ä½œé«˜æ•ˆï¼ˆO(1)ï¼‰**ï¼š
  - **åœ¨ä¸­é—´æ’å…¥/åˆ é™¤** å…ƒç´ ä¸éœ€è¦ç§»åŠ¨å…¶ä»–å…ƒç´ ï¼Œåªéœ€è¦è°ƒæ•´æŒ‡é’ˆã€‚
  - **åœ¨å¤´éƒ¨/å°¾éƒ¨æ’å…¥/åˆ é™¤** çš„æ•ˆç‡è¿œé«˜äº `vector`ã€‚
- **ä¸æ”¯æŒéšæœºè®¿é—®ï¼ˆO(nï¼‰ï¼‰**ï¼š
  - ä¸èƒ½ä½¿ç”¨ `[]` æˆ– `at(i)` è®¿é—®ç‰¹å®šç´¢å¼•å…ƒç´ ï¼Œåªèƒ½ä½¿ç”¨ **è¿­ä»£å™¨éå†**ã€‚
- **æ¯” `vector` å ç”¨æ›´å¤šå†…å­˜**ï¼š
  - ç”±äºå­˜å‚¨äº†é¢å¤–çš„æŒ‡é’ˆï¼ˆ`prev` å’Œ `next`ï¼‰ï¼Œ`list` çš„å†…å­˜å¼€é”€æ¯” `vector` å¤§ã€‚

------

#### **2. `list` çš„å¸¸è§æ“ä½œ**

##### **ï¼ˆ1ï¼‰å®šä¹‰å’Œåˆå§‹åŒ–**

```cpp
#include <iostream>
#include <list>
using namespace std;

int main() {
    list<int> lst1;               // ç©ºé“¾è¡¨
    list<int> lst2(5);            // 5 ä¸ªå…ƒç´ ï¼Œé»˜è®¤åˆå§‹åŒ–ä¸º 0
    list<int> lst3(5, 10);        // 5 ä¸ªå…ƒç´ ï¼Œæ¯ä¸ªå€¼ä¸º 10
    list<int> lst4 = {1, 2, 3};   // åˆ—è¡¨åˆå§‹åŒ–
    list<int> lst5(lst4);         // æ‹·è´æ„é€ 

    return 0;
}
```

------

##### **ï¼ˆ2ï¼‰åŸºæœ¬æ“ä½œ**

| æ“ä½œ     | æ–¹æ³•                         | è¯´æ˜                              |
| -------- | ---------------------------- | --------------------------------- |
| **å¢**   | `push_back(x)`               | æœ«å°¾æ·»åŠ å…ƒç´                       |
| **å¢**   | `push_front(x)`              | å¤´éƒ¨æ·»åŠ å…ƒç´                       |
| **æ’**   | `insert(it, x)`              | åœ¨æŒ‡å®šä½ç½®æ’å…¥                    |
| **åˆ **   | `pop_back()`                 | åˆ é™¤æœ«å°¾å…ƒç´                       |
| **åˆ **   | `pop_front()`                | åˆ é™¤å¤´éƒ¨å…ƒç´                       |
| **åˆ **   | `erase(it)`                  | åˆ é™¤æŒ‡å®šä½ç½®å…ƒç´                   |
| **æ”¹**   | `it = lst.begin(); *it = x;` | é€šè¿‡è¿­ä»£å™¨ä¿®æ”¹å…ƒç´                 |
| **æŸ¥**   | `front()` / `back()`         | è·å–å¤´/å°¾å…ƒç´                      |
| **å¤§å°** | `size()`                     | è·å–å…ƒç´ ä¸ªæ•°                      |
| **æ¸…ç©º** | `clear()`                    | æ¸…ç©ºæ‰€æœ‰å…ƒç´                       |
| **æ’åº** | `sort()`                     | å‡åºæ’åºï¼ˆé»˜è®¤ `operator<` æ¯”è¾ƒï¼‰ |
| **åè½¬** | `reverse()`                  | åè½¬é“¾è¡¨                          |
| **åˆå¹¶** | `merge(lst2)`                | åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨                  |
| **å»é‡** | `unique()`                   | åˆ é™¤ç›¸é‚»é‡å¤å…ƒç´                   |

ç¤ºä¾‹ï¼š

```cpp
#include <iostream>
#include <list>
using namespace std;

int main() {
    list<int> lst = {1, 2, 3, 4, 5};

    lst.push_front(0);  // å¤´éƒ¨æ’å…¥ 0
    lst.push_back(6);   // å°¾éƒ¨æ’å…¥ 6

    lst.pop_front();    // åˆ é™¤å¤´éƒ¨å…ƒç´  0
    lst.pop_back();     // åˆ é™¤å°¾éƒ¨å…ƒç´  6

    for (int num : lst) {
        cout << num << " ";  // è¾“å‡º 1 2 3 4 5
    }

    return 0;
}
```

------

##### **ï¼ˆ3ï¼‰éå† `list`**

**æ–¹æ³• 1ï¼šèŒƒå›´ `for` å¾ªç¯**

```cpp
for (int num : lst) {
    cout << num << " ";
}
```

**æ–¹æ³• 2ï¼šè¿­ä»£å™¨**

```cpp
for (list<int>::iterator it = lst.begin(); it != lst.end(); ++it) {
    cout << *it << " ";
}
```

**æ–¹æ³• 3ï¼šC++11 `auto` å…³é”®å­—**

```cpp
for (auto it = lst.begin(); it != lst.end(); ++it) {
    cout << *it << " ";
}
```

------

##### **ï¼ˆ4ï¼‰æ’å…¥å’Œåˆ é™¤**

`list` å…è®¸åœ¨ä»»æ„ä½ç½®é«˜æ•ˆæ’å…¥/åˆ é™¤ï¼š

```cpp
#include <iostream>
#include <list>
using namespace std;

int main() {
    list<int> lst = {1, 2, 3, 4, 5};

    auto it = lst.begin();
    advance(it, 2); // ç§»åŠ¨åˆ°ç¬¬ 3 ä¸ªå…ƒç´ ï¼ˆä» 0 å¼€å§‹è®¡æ•°ï¼‰

    lst.insert(it, 99);  // åœ¨ç¬¬ 3 ä¸ªå…ƒç´ å‰æ’å…¥ 99
    lst.erase(it);       // åˆ é™¤ç¬¬ 3 ä¸ªå…ƒç´ ï¼ˆåŸæ¥çš„ 3ï¼‰

    for (int num : lst) {
        cout << num << " ";
    }

    return 0;
}
```

------

##### **ï¼ˆ5ï¼‰æ’åºå’Œå»é‡**

#### **æ’åº**

`list` è‡ªå¸¦ `sort()` æ–¹æ³•ï¼Œå¯ä»¥å¯¹é“¾è¡¨è¿›è¡Œæ’åºï¼š

```cpp
list<int> lst = {4, 2, 3, 1, 5};
lst.sort();  // å‡åºæ’åº
```

ä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰æ’åºè§„åˆ™ï¼š

```cpp
lst.sort([](int a, int b) { return a > b; });  // é™åºæ’åº
```

#### **å»é‡**

`unique()` åªèƒ½åˆ é™¤ **ç›¸é‚»çš„é‡å¤å…ƒç´ **ï¼š

```cpp
list<int> lst = {1, 2, 2, 3, 3, 4, 5};
lst.unique();  // å˜ä¸º {1, 2, 3, 4, 5}
```

å¦‚æœ `list` ä¸æ˜¯æ’åºå¥½çš„ï¼Œå»é‡å‰éœ€è¦å…ˆ `sort()`ï¼š

```cpp
lst.sort();
lst.unique();
```

------

#### **3. `list` ä¸ `vector` çš„æ¯”è¾ƒ**

| ç‰¹æ€§          | `list`                   | `vector`                 |
| ------------- | ------------------------ | ------------------------ |
| åº•å±‚ç»“æ„      | **åŒå‘é“¾è¡¨**             | **åŠ¨æ€æ•°ç»„**             |
| éšæœºè®¿é—®      | **O(n)ï¼ˆä¸æ”¯æŒ `[]`ï¼‰**  | **O(1)ï¼ˆæ”¯æŒ `[]`ï¼‰**    |
| å¤´éƒ¨æ’å…¥/åˆ é™¤ | **O(1)**                 | **O(n)**                 |
| ä¸­é—´æ’å…¥/åˆ é™¤ | **O(1)**ï¼ˆéœ€è¦è¿­ä»£å™¨ï¼‰   | **O(n)**ï¼ˆéœ€è¦ç§»åŠ¨å…ƒç´ ï¼‰ |
| æœ«å°¾æ’å…¥/åˆ é™¤ | **O(1)**                 | **O(1)**ï¼ˆå¦‚æœæ— æ‰©å®¹ï¼‰   |
| å†…å­˜å ç”¨      | **è¾ƒå¤§**ï¼ˆå­˜å‚¨é¢å¤–æŒ‡é’ˆï¼‰ | **è¾ƒå°**ï¼ˆè¿ç»­å­˜å‚¨ï¼‰     |
| é€‚ç”¨åœºæ™¯      | **é¢‘ç¹æ’å…¥/åˆ é™¤**        | **é¢‘ç¹è®¿é—®ã€æ‰¹é‡å¤„ç†**   |

------

#### **4. `list` é€‚ç”¨åœºæ™¯**

- éœ€è¦ **é¢‘ç¹æ’å…¥æˆ–åˆ é™¤**ï¼ˆç‰¹åˆ«æ˜¯ **ä¸­é—´** ä½ç½®ï¼‰ã€‚
- **ä¸éœ€è¦éšæœºè®¿é—®**ï¼Œä¸»è¦è¿›è¡Œ **é¡ºåºéå†**ã€‚
- éœ€è¦æ”¯æŒ **åˆå¹¶ã€æ’åºã€å»é‡** æ“ä½œã€‚
- é€‚åˆ **å¤§å‹æ•°æ®ç»“æ„**ï¼Œå¦‚ **é“¾è¡¨ã€é˜Ÿåˆ—ã€æ ˆ**ã€‚

**å¦‚æœéœ€è¦é¢‘ç¹è®¿é—®å…ƒç´ ï¼Œå»ºè®®ä½¿ç”¨ `vector`ï¼›å¦‚æœæ’å…¥/åˆ é™¤è¾ƒå¤šï¼Œå»ºè®®ä½¿ç”¨ `list`ã€‚**

------

#### **æ€»ç»“**

1. **`list` æ˜¯åŒå‘é“¾è¡¨**ï¼Œæ”¯æŒ **O(1) å¤´éƒ¨/å°¾éƒ¨æ’å…¥åˆ é™¤**ï¼Œä½†ä¸æ”¯æŒ **O(1) éšæœºè®¿é—®**ã€‚
2. **é€‚åˆé¢‘ç¹çš„æ’å…¥/åˆ é™¤æ“ä½œ**ï¼Œç‰¹åˆ«æ˜¯ **ä¸­é—´ä½ç½®** çš„ä¿®æ”¹ã€‚
3. **æ¯” `vector` å ç”¨æ›´å¤šå†…å­˜**ï¼Œä½†å¯é€šè¿‡ `sort()`ã€`merge()`ã€`unique()` è¿›è¡Œé«˜æ•ˆæ“ä½œã€‚
4. **é€‚ç”¨äºé˜Ÿåˆ—ã€é“¾è¡¨ã€æ’åºã€å»é‡ç­‰æ“ä½œ**ï¼Œä½†å¦‚æœéœ€è¦ **éšæœºè®¿é—®**ï¼Œåº”è¯¥ä½¿ç”¨ `vector`ã€‚





## cpp æ³›å‹ç¼–ç¨‹



#### æ¨¡æ¿å…¨ç‰¹åŒ–å’Œåç‰¹åŒ–

â¼€ä¸ªæ¨¡æ¿è¢«ç§°ä¸ºå…¨ç‰¹åŒ–çš„æ¡ä»¶ï¼š1.å¿…é¡»æœ‰â¼€ä¸ªä¸»æ¨¡æ¿ç±» 2.æ¨¡æ¿ç±»å‹è¢«å…¨éƒ¨æ˜ç¡®åŒ–ã€‚  

**ç±»æ¨¡æ¿**

```cpp
template<typename T1, typename T2>
class Test
{
    public:
    Test(T1 i,T2 j):a(i),b(j){cout<<"æ¨¡æ¿ç±»"<<endl;}
    private:
    T1 a;
    T2 b;
};

template<>
class Test<int , char>
{
    public:
    Test(int i, char j):a(i),b(j){cout<<"å…¨ç‰¹åŒ–"<<endl;}
    private:
    int a;
    char b;
};

template <typename T2>
class Test<char, T2>
{
    public:
    Test(char i, T2 j):a(i),b(j){cout<<"åç‰¹åŒ–"<<endl;}
    private:
    char a;
    T2 b;
}
```

**å‡½æ•°æ¨¡æ¿**

å‡½æ•°æ¨¡æ¿ï¼Œåªæœ‰å…¨ç‰¹åŒ–ï¼Œåç‰¹åŒ–çš„åŠŸèƒ½å¯ä»¥é€šè¿‡å‡½æ•°çš„é‡è½½å®Œæˆã€‚  

```cpp
#include <iostream>
using namespace std;

// é€šç”¨æ¨¡æ¿
template <typename T>
void print(T value) {
    cout << "é€šç”¨æ¨¡æ¿: " << value << endl;
}

// å…¨ç‰¹åŒ–ï¼šé’ˆå¯¹ int ç±»å‹
template <>
void print<int>(int value) {
    cout << "å…¨ç‰¹åŒ–: å¤„ç† int -> " << value << endl;
}

// åç‰¹åŒ–ï¼ˆé€šè¿‡é‡è½½å®ç°ï¼‰ï¼šé’ˆå¯¹æŒ‡é’ˆç±»å‹
template <typename T>
void print(T* value) {
    cout << "åç‰¹åŒ–: å¤„ç†æŒ‡é’ˆç±»å‹ -> " << *value << endl;
}

int main() {
    print(3.14);    // é€šç”¨æ¨¡æ¿: 3.14
    print(42);      // å…¨ç‰¹åŒ–: å¤„ç† int -> 42
    string str = "hello";
    print(&str);    // åç‰¹åŒ–: å¤„ç†æŒ‡é’ˆç±»å‹ -> hello
    return 0;
}
```

**ç‰¹æ®Šæ¡ˆä¾‹ï¼šæŒ‡é’ˆåç‰¹åŒ–**

```cpp
#include <iostream>
using namespace std;

// é€šç”¨æ¨¡æ¿
template <typename T>
class MyClass {
public:
    void show() { cout << "é€šç”¨æ¨¡æ¿: " << typeid(T).name() << endl; }
};

// åç‰¹åŒ–ï¼šT æ˜¯æŒ‡é’ˆç±»å‹æ—¶
template <typename T>
class MyClass<T*> {
public:
    void show() { cout << "åç‰¹åŒ–: T æ˜¯æŒ‡é’ˆç±»å‹ -> " << typeid(T).name() << "*" << endl; }
};

int main() {
    MyClass<int> obj1;
    obj1.show(); // è¾“å‡ºï¼šé€šç”¨æ¨¡æ¿: int

    MyClass<int*> obj2;
    obj2.show(); // è¾“å‡ºï¼šåç‰¹åŒ–: T æ˜¯æŒ‡é’ˆç±»å‹ -> int*

    return 0;
}
```





## cpp11çš„æ–°ç‰¹æ€§



### **ç»Ÿä¸€çš„åˆå§‹åŒ–æ–¹æ³•**

åœ¨ C++11 ä¹‹å‰ï¼Œåˆå§‹åŒ–ä¸åŒç±»å‹çš„å˜é‡å’Œå®¹å™¨æœ‰ä¸åŒçš„æ–¹å¼ï¼Œå®¹æ˜“æ··æ·†ã€‚è€Œ C++11 å¼•å…¥äº† **ç»Ÿä¸€çš„åˆå§‹åŒ–æ–¹æ³•**ï¼ˆåˆ—è¡¨åˆå§‹åŒ– `{}`ï¼‰ï¼Œä½¿å¾—åˆå§‹åŒ–æ›´åŠ ç®€æ´ã€å®‰å…¨ã€‚

```cpp
#include <iostream>
#include <vector>
using namespace std;

int main() {
    int a = 10;     // ä¼ ç»Ÿåˆå§‹åŒ–
    int b(20);      // ä¼ ç»Ÿåˆå§‹åŒ–
    int c{30};      // C++11 ç»Ÿä¸€åˆå§‹åŒ–
    int d = {40};   // C++11 ç»Ÿä¸€åˆå§‹åŒ–

    vector<int> vec1 = {1, 2, 3, 4, 5}; // ç»Ÿä¸€åˆå§‹åŒ–
    vector<int> vec2{6, 7, 8, 9, 10};   // ç»Ÿä¸€åˆå§‹åŒ–

    cout << "a=" << a << ", b=" << b << ", c=" << c << ", d=" << d << endl;
    return 0;
}
```

**ä¼˜ç‚¹**

- **é˜²æ­¢çª„åŒ–è½¬æ¢**ï¼ˆnarrowing conversionï¼‰ï¼Œæ¯”å¦‚ `double` èµ‹å€¼ç»™ `int` æ—¶ä¼šå‡ºé”™ã€‚
- **æ”¯æŒåˆå§‹åŒ– STL å®¹å™¨**ï¼Œæ›´ç®€æ´ç›´è§‚ã€‚

------

### **æˆå‘˜å˜é‡é»˜è®¤åˆå§‹åŒ–**

C++11 å…è®¸ç±»çš„**æˆå‘˜å˜é‡åœ¨å®šä¹‰æ—¶ç›´æ¥åˆå§‹åŒ–**ï¼Œä¸éœ€è¦åœ¨æ„é€ å‡½æ•°ä¸­åˆå§‹åŒ–ï¼Œç®€åŒ–äº†ä»£ç ã€‚

```cpp
#include <iostream>
using namespace std;

class Test {
private:
    int x{10};  // ç›´æ¥åˆå§‹åŒ–
    double y = 3.14; // ä¹Ÿå¯ä»¥ä½¿ç”¨ = è¿›è¡Œåˆå§‹åŒ–
public:
    void show() {
        cout << "x = " << x << ", y = " << y << endl;
    }
};

int main() {
    Test t;
    t.show(); // è¾“å‡ºï¼šx = 10, y = 3.14
    return 0;
}
```

**ä¼˜ç‚¹**

- **ä»£ç æ›´æ¸…æ™°**ï¼Œå‡å°‘æ„é€ å‡½æ•°çš„åˆå§‹åŒ–ä»£ç ã€‚
- **é¿å…æœªåˆå§‹åŒ–å˜é‡çš„é”™è¯¯**ã€‚

------

### **`auto` å…³é”®å­—**

`auto` å…è®¸ç¼–è¯‘å™¨è‡ªåŠ¨æ¨å¯¼å˜é‡çš„ç±»å‹ï¼Œå‡å°‘æ‰‹åŠ¨å£°æ˜çš„å†—ä½™ï¼Œä½¿ä»£ç æ›´ç®€æ´ã€‚

```cpp
#include <iostream>
#include <vector>
using namespace std;

int main() {
    auto x = 42;     // x è¢«æ¨å¯¼ä¸º int
    auto y = 3.14;   // y è¢«æ¨å¯¼ä¸º double
    auto z = "Hello"; // z è¢«æ¨å¯¼ä¸º const char*

    vector<int> vec = {1, 2, 3, 4};
    for (auto v : vec) {
        cout << v << " "; // è‡ªåŠ¨æ¨å¯¼ v çš„ç±»å‹
    }
    return 0;
}
```

**ä¼˜ç‚¹**

- **å‡å°‘å†—é•¿çš„ç±»å‹å£°æ˜**ï¼Œå°¤å…¶æ˜¯æ¨¡æ¿ç±»å‹ã€‚
- **æé«˜ä»£ç å¯è¯»æ€§**ã€‚

------

### **`decltype` å…³é”®å­—**

`decltype` ç”¨äºè·å–è¡¨è¾¾å¼çš„**ç±»å‹**ï¼Œç±»ä¼¼äº `typeof`ã€‚

```cpp
#include <iostream>
using namespace std;

int main() {
    int a = 10;
    decltype(a) b = 20; // b çš„ç±»å‹å’Œ a ä¸€æ ·ï¼Œéƒ½æ˜¯ int

    cout << "b = " << b << endl; // è¾“å‡ºï¼šb = 20
    return 0;
}
```

**ç”¨é€”**

- **ç”¨äºæ¨¡æ¿å…ƒç¼–ç¨‹**ï¼Œå¯è·å–å˜é‡ã€è¡¨è¾¾å¼æˆ–å‡½æ•°è¿”å›å€¼çš„ç±»å‹ã€‚

------

### **æ™ºèƒ½æŒ‡é’ˆ**

C++11 å¼•å…¥äº† **æ™ºèƒ½æŒ‡é’ˆ**ï¼Œç”¨äºè‡ªåŠ¨ç®¡ç†åŠ¨æ€åˆ†é…çš„å¯¹è±¡ï¼Œé¿å…å†…å­˜æ³„æ¼ã€‚

```cpp
#include <iostream>
#include <memory>
using namespace std;

int main() {
    shared_ptr<int> p1 = make_shared<int>(10); // åˆ›å»º shared_ptr
    unique_ptr<int> p2 = make_unique<int>(20); // åˆ›å»º unique_ptr

    cout << "p1 = " << *p1 << ", p2 = " << *p2 << endl;
    return 0;
}
```

**ä¼˜ç‚¹**

- **è‡ªåŠ¨ç®¡ç†èµ„æº**ï¼Œé¿å…æ‰‹åŠ¨ `delete`ã€‚
- **`shared_ptr`** å…è®¸å¤šä¸ªæŒ‡é’ˆå…±äº«åŒä¸€èµ„æºã€‚
- **`unique_ptr`** åªèƒ½æœ‰ä¸€ä¸ªæ‰€æœ‰è€…ï¼Œé˜²æ­¢è¯¯ç”¨ã€‚

------

### **`nullptr` å…³é”®å­—**

C++11 å¼•å…¥ `nullptr` ä½œä¸º **ç©ºæŒ‡é’ˆçš„æ ‡å‡†è¡¨ç¤º**ï¼Œæ›¿ä»£ `NULL`ï¼Œæé«˜ç±»å‹å®‰å…¨æ€§ã€‚

```cpp
#include <iostream>
using namespace std;

void func(int* ptr) {
    if (ptr) cout << "æŒ‡é’ˆæœ‰æ•ˆ" << endl;
    else cout << "ç©ºæŒ‡é’ˆ" << endl;
}

int main() {
    func(nullptr); // ä¼ é€’ nullptr
    return 0;
}
```

------

### **åŸºäºèŒƒå›´çš„ `for` å¾ªç¯**

ç®€åŒ–éå† **æ•°ç»„** å’Œ **STL å®¹å™¨**ã€‚

```cpp
#include <iostream>
#include <vector>
using namespace std;

int main() {
    vector<int> vec = {1, 2, 3, 4, 5};
    for (int v : vec) { // éå† vec
        cout << v << " ";
    }
    return 0;
}
```

------

### **å³å€¼å¼•ç”¨ (`&&`) å’Œ `move` è¯­ä¹‰**

#### å·¦å€¼å’Œå³å€¼

```cpp
//å·¦å€¼ï¼ˆLvalueï¼‰ï¼šå¯ä»¥å–åœ°å€ï¼Œæœ‰åç§°çš„å˜é‡ï¼Œä¾‹å¦‚ï¼š
int a = 10;  // a æ˜¯å·¦å€¼
//å³å€¼ï¼ˆRvalueï¼‰ï¼šä¸´æ—¶å€¼ï¼Œæ²¡æœ‰åç§°ï¼Œä¸èƒ½å–åœ°å€ï¼Œä¾‹å¦‚ï¼š
int b = 2 + 3;  // 2+3 æ˜¯å³å€¼
int c = a * 5;  // a*5 æ˜¯å³å€¼

int x = 10;  // x æ˜¯å·¦å€¼
int y = x + 20; // x+20 æ˜¯å³å€¼
```

C++11 å…è®¸ä½¿ç”¨ `&&` æ¥**ç»‘å®šå³å€¼**ï¼š

```cpp
int &&r = 10;  // 10 æ˜¯å³å€¼ï¼Œr ç»‘å®šå®ƒ
```

ä½†ä¸èƒ½ç»‘å®š**å·¦å€¼**ï¼š

```cpp
int a = 10;
int &&r = a;  // âŒ é”™è¯¯ï¼Œä¸èƒ½ç»‘å®šå·¦å€¼
```

**è§£å†³æ–¹æ¡ˆ**ï¼šä½¿ç”¨ `std::move()` å°†å·¦å€¼è½¬æ¢ä¸ºå³å€¼ï¼š

```cpp
int &&r = std::move(a); // âœ… è¿™æ ·æ‰è¡Œ
```

ç”¨äºå‡½æ•°é‡è½½ï¼š

```cpp
void process(int& x) { cout << "å·¦å€¼å¼•ç”¨" << endl; }
void process(int&& x) { cout << "å³å€¼å¼•ç”¨" << endl; }

int main() {
    int a = 10;
    process(a);  // è¾“å‡ºï¼šå·¦å€¼å¼•ç”¨
    process(20); // è¾“å‡ºï¼šå³å€¼å¼•ç”¨
}
```

#### ç§»åŠ¨æ„é€ 

```cpp
#include <iostream>
#include <vector>
using namespace std;

class Test {
public:
    vector<int> data;
    Test() { cout << "é»˜è®¤æ„é€ " << endl; }
    Test(const Test& t) { cout << "æ‹·è´æ„é€ " << endl; } // ä¼ ç»Ÿæ‹·è´
    Test(Test&& t) noexcept { // ç§»åŠ¨æ„é€ 
        cout << "ç§»åŠ¨æ„é€ " << endl;
        data = move(t.data);
    }
};

int main() {
    Test t1;
    Test t2 = t1;       // è°ƒç”¨æ‹·è´æ„é€ 
    Test t3 = move(t1); // è°ƒç”¨ç§»åŠ¨æ„é€ 
    return 0;
}
```

```cpp
#include <iostream>
#include <vector>
using namespace std;

class Test {
public:
    vector<int> data;
    
    Test() { cout << "é»˜è®¤æ„é€ " << endl; }

    // æ‹·è´æ„é€ ï¼ˆæ·±æ‹·è´ï¼Œåˆ›å»ºæ–°å‰¯æœ¬ï¼‰
    Test(const Test& t) {
        cout << "æ‹·è´æ„é€ " << endl;
        data = t.data;
    }

    // ç§»åŠ¨æ„é€ ï¼ˆå·èµ°èµ„æºï¼‰
    Test(Test&& t) noexcept {
        cout << "ç§»åŠ¨æ„é€ " << endl;
        data = move(t.data); // â€œå·èµ°â€èµ„æº
    }
};

int main() {
    Test t1;
    Test t2 = t1;       // è°ƒç”¨æ‹·è´æ„é€ 
    Test t3 = move(t1); // è°ƒç”¨ç§»åŠ¨æ„é€ ï¼ˆt1 èµ„æºè¢«å·èµ°ï¼‰
    return 0;
}
```

- **æ‹·è´æ„é€ **ï¼šéœ€è¦ **åˆ†é…æ–°å†…å­˜ + å¤åˆ¶æ•°æ®**ï¼Œé€Ÿåº¦æ…¢ã€‚
- **ç§»åŠ¨æ„é€ **ï¼š**åªæ˜¯è½¬ç§»æŒ‡é’ˆ**ï¼Œ**ä¸å¤åˆ¶æ•°æ®**ï¼Œé€Ÿåº¦å¿«ã€‚

`std::move()` ä¸ä¼šåˆ é™¤å¯¹è±¡ï¼Œè€Œæ˜¯è½¬ç§»å¯¹è±¡çš„èµ„æºï¼Œä½¿åŸå¯¹è±¡çš„èµ„æºå˜ä¸ºç©ºï¼Œæé«˜ç¨‹åºè¿è¡Œæ•ˆç‡ï¼

#### noexceptå…³é”®å­—

C++ æ ‡å‡†åº“çš„æŸäº›å®¹å™¨ï¼ˆå¦‚ `std::vector`ï¼‰åœ¨**æ‰©å®¹æˆ–é‡æ–°åˆ†é…å†…å­˜æ—¶**ï¼Œå¦‚æœå…ƒç´ ç±»å‹çš„**ç§»åŠ¨æ„é€ å‡½æ•°**æ˜¯ `noexcept`ï¼Œåˆ™ä¼šä½¿ç”¨**ç§»åŠ¨æ“ä½œ**è€Œä¸æ˜¯**æ‹·è´æ“ä½œ**ã€‚

å¦‚æœ**æ²¡æœ‰ `noexcept`**ï¼Œæ ‡å‡†åº“ä¼šé€‰æ‹©**æ‹·è´æ„é€ **ï¼Œå³ä½¿æœ‰ç§»åŠ¨æ„é€ ï¼

å› ä¸ºå¦‚æœç§»åŠ¨æ„é€ å¯èƒ½æŠ›å¼‚å¸¸ï¼Œä¸‡ä¸€ç§»åŠ¨å¤±è´¥ï¼Œç¨‹åºçŠ¶æ€å¯èƒ½ä¼šå˜å¾—ä¸å¯é¢„æµ‹ï¼Œæ‰€ä»¥ `std::vector` ç­‰å®¹å™¨ä¼šå›é€€åˆ°**æ›´å®‰å…¨çš„æ‹·è´æ„é€ **ï¼ˆä½†æ€§èƒ½æ›´å·®ï¼‰ã€‚

#### å®Œç¾è½¬å‘

```cpp
#include <iostream>
using namespace std;

void func(int& x) { cout << "å·¦å€¼å¼•ç”¨" << endl; }  // å¤„ç†å·¦å€¼çš„ç‰ˆæœ¬
void func(int&& x) { cout << "å³å€¼å¼•ç”¨" << endl; } // å¤„ç†å³å€¼çš„ç‰ˆæœ¬

void wrapper(int x) { // âŒ ä¼ å€¼è°ƒç”¨ï¼Œæ— æ³•åŒºåˆ†å·¦å€¼å³å€¼
    func(x);  // è¿™é‡Œçš„ `x` æ˜¯å·¦å€¼
}

int main() {
    int a = 10;
    wrapper(a);    // âŒ æœŸæœ›è°ƒç”¨ `func(int&)`ï¼Œä½† `x` å˜æˆå·¦å€¼
    wrapper(20);   // âŒ å³å€¼ `20` ä¼ è¿›æ¥å˜å·¦å€¼
}
```

- `wrapper` ä¼ å€¼è°ƒç”¨æ—¶ï¼Œå‚æ•° `x` æ˜¯å·¦å€¼ï¼Œå¯¼è‡´ `func(x)` æ— æ³•åŒºåˆ†åŸå§‹çš„å·¦å³å€¼å±æ€§ï¼
- æ— è®º `wrapper(a)` è¿˜æ˜¯ `wrapper(20)`ï¼Œ`x` åœ¨ `wrapper` å†…éƒ¨éƒ½æ˜¯å·¦å€¼ï¼Œå¯¼è‡´é”™è¯¯è°ƒç”¨ `func(x)`ã€‚

è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ï¼š

- ä¿æŒ `wrapper` ä¼ é€’å‚æ•°çš„åŸå§‹å·¦å³å€¼å±æ€§
- ç¡®ä¿ `wrapper(a)` ä¼ å·¦å€¼ï¼Œ`wrapper(20)` ä¼ å³å€¼

âœ… ä½¿ç”¨ `std::forward<T>(arg)` è¿›è¡Œå®Œç¾è½¬å‘

```cpp
#include <iostream>
using namespace std;

void func(int& x) { cout << "å·¦å€¼å¼•ç”¨" << endl; }
void func(int&& x) { cout << "å³å€¼å¼•ç”¨" << endl; }

template<typename T>
void wrapper(T&& arg) { // T&& æ˜¯ä¸‡èƒ½å¼•ç”¨
    func(std::forward<T>(arg)); // std::forward ä¿æŒå·¦å³å€¼å±æ€§
}

int main() {
    int a = 10;
    wrapper(a);    // âœ… `a` æ˜¯å·¦å€¼ï¼Œè°ƒç”¨ `func(int&)`
    wrapper(20);   // âœ… `20` æ˜¯å³å€¼ï¼Œè°ƒç”¨ `func(int&&)`
}
```

ä½¿ç”¨ä¾‹ï¼šæ„é€ å‡½æ•°è½¬å‘

```cpp
#include <iostream>
using namespace std;

class Person {
public:
    template<typename T1, typename T2>
    Person(T1&& name, T2&& age) : name_(forward<T1>(name)), age_(forward<T2>(age)) {}

private:
    string name_;
    int age_;
};

int main() {
    string myName = "Alice";
    Person p1(myName, 25);   // âœ… `myName` æ˜¯å·¦å€¼ï¼Œstd::forward ä¿æŒå·¦å€¼
    Person p2("Bob", 30);    // âœ… `"Bob"` æ˜¯å³å€¼ï¼Œstd::forward ä¿æŒå³å€¼
}
```

#### moveä¸forward

| åŠŸèƒ½             | `std::move(arg)`                     | `std::forward<T>(arg)`      |
| ---------------- | ------------------------------------ | --------------------------- |
| ç”¨é€”             | å¼ºåˆ¶è½¬æ¢ä¸ºå³å€¼                       | ä»…åœ¨ `T` ä¸ºå³å€¼æ—¶è½¬æ¢ä¸ºå³å€¼ |
| æ˜¯å¦ä¿ç•™å‚æ•°ç±»å‹ | å¦ï¼Œç›´æ¥å˜æˆå³å€¼                     | æ˜¯ï¼Œä¿ç•™å·¦å€¼æˆ–å³å€¼å±æ€§      |
| é€‚ç”¨åœºæ™¯         | æ˜¾å¼ç§»åŠ¨å¯¹è±¡ï¼ˆå¦‚ `std::unique_ptr`ï¼‰ | å®Œç¾è½¬å‘                    |

```cpp
void test(int&& x) {}

int a = 10;
test(std::move(a));  // âœ… std::move å¼ºåˆ¶ `a` å˜æˆå³å€¼

template<typename T>
void wrapper(T&& arg) {
    test(std::forward<T>(arg));  // âœ… `std::forward` åªæœ‰åœ¨åŸæœ¬æ˜¯å³å€¼æ—¶æ‰ä¼šè½¬æˆå³å€¼
}
```

`std::move` å¼ºåˆ¶è½¬æ¢ä¸ºå³å€¼ï¼Œ`std::forward` åªåœ¨å¿…è¦æ—¶è½¬æ¢ä¸ºå³å€¼ï¼



#### ä¸‡èƒ½å¼•ç”¨

ä»€ä¹ˆæ—¶å€™ `T&&` æ˜¯å³å€¼å¼•ç”¨ï¼Œä»€ä¹ˆæ—¶å€™æ˜¯ä¸‡èƒ½å¼•ç”¨ï¼Ÿ

- `T&&` æ˜¯å³å€¼å¼•ç”¨ï¼šå½“ `T` æ˜¯éæ¨¡æ¿å‚æ•°æˆ–æ˜¾å¼æŒ‡å®šçš„ç±»å‹ã€‚
- `T&&` æ˜¯ä¸‡èƒ½å¼•ç”¨ï¼šå½“ `T` é€šè¿‡æ¨¡æ¿å‚æ•°æ¨å¯¼å‡ºæ¥ï¼Œå¹¶ä¸” `T&&` ç›´æ¥å‡ºç°åœ¨ æ¨¡æ¿å‚æ•°ä¸­ã€‚

```cpp
template <typename T>
void wrapper(T&& x) {}

int a = 10;
wrapper(a);  // T è¢«æ¨å¯¼ä¸º int&ï¼Œæ‰€ä»¥ wrapper<int&>(int& x)
wrapper(20); // T è¢«æ¨å¯¼ä¸º intï¼Œ  æ‰€ä»¥ wrapper<int>(int&& x)
```

å³å€¼å¼•ç”¨ï¼š

```cpp
void func(int&& x) {
    cout << "å³å€¼å¼•ç”¨" << endl;
}

int main() {
    int a = 10;
    func(a);  // âŒ é”™è¯¯ï¼Œa æ˜¯å·¦å€¼ï¼Œä¸èƒ½ç»‘å®šåˆ° int&&
    func(20); // âœ… æ­£ç¡®ï¼Œ20 æ˜¯å³å€¼
}
```

ä¸‡èƒ½å¼•ç”¨ï¼š

```cpp
template <typename T>
void wrapper(T&& x) {
    cout << "T æ˜¯ " << typeid(T).name() << endl;
}

int main() {
    int a = 10;
    wrapper(a);   // âœ… T è¢«æ¨å¯¼ä¸º int&ï¼Œæ‰€ä»¥ T&& å˜æˆ int&
    wrapper(20);  // âœ… T è¢«æ¨å¯¼ä¸º intï¼Œ æ‰€ä»¥ T&& å˜æˆ int&&
}
```



### **æ— åºå®¹å™¨ (`unordered_map` ç­‰)**

C++11 å¼•å…¥äº† **å“ˆå¸Œè¡¨å®¹å™¨**ï¼Œç›¸æ¯” `map`ï¼Œæ•ˆç‡æ›´é«˜ã€‚

```cpp
#include <iostream>
#include <unordered_map>
using namespace std;

int main() {
    unordered_map<string, int> myMap = {{"Alice", 25}, {"Bob", 30}};
    cout << "Alice: " << myMap["Alice"] << endl;
    return 0;
}
```

------

### **æ­£åˆ™è¡¨è¾¾å¼ (`regex`)**

æ”¯æŒ **æ­£åˆ™åŒ¹é…** å’Œ **å­—ç¬¦ä¸²å¤„ç†**ã€‚

```cpp
#include <iostream>
#include <regex>
using namespace std;

int main() {
    string str = "abc123";
    regex pattern("[a-z]+[0-9]+");
    cout << (regex_match(str, pattern) ? "åŒ¹é…æˆåŠŸ" : "åŒ¹é…å¤±è´¥") << endl;
    return 0;
}
```

------

### **Lambda è¡¨è¾¾å¼**

æ”¯æŒ **åŒ¿åå‡½æ•°**ï¼Œç®€åŒ–ä»£ç ã€‚

```cpp
#include <iostream>
using namespace std;

int main() {
    auto add = [](int a, int b) { return a + b; };
    cout << "3 + 5 = " << add(3, 5) << endl;
    return 0;
}
```

















## å…¶ä»–



### std::allocator

`allocator`æ˜¯æ ‡å‡†åº“æä¾›çš„ä¸€ä¸ªé€šç”¨å·¥å…·ï¼Œç”¨äºç®¡ç†å†…å­˜åˆ†é…å’Œé‡Šæ”¾ã€‚å®ƒæ˜¯STLï¼ˆæ ‡å‡†æ¨¡æ¿åº“ï¼‰å®¹å™¨å¦‚`vector`ã€`list`ç­‰èƒŒåè¿›è¡Œå†…å­˜ç®¡ç†çš„æœºåˆ¶ã€‚é€šè¿‡è‡ªå®šä¹‰åˆ†é…å™¨ï¼Œå¼€å‘è€…å¯ä»¥æ§åˆ¶å®¹å™¨å¦‚ä½•è·å–å’Œé‡Šæ”¾å†…å­˜ï¼Œè¿™å¯¹äºä¼˜åŒ–æ€§èƒ½æˆ–ä½¿ç”¨ç‰¹å®šç±»å‹çš„å†…å­˜èµ„æºéå¸¸æœ‰ç”¨ã€‚

```cpp
#include <iostream>
#include <memory> // std::allocatorä½äºè¯¥å¤´æ–‡ä»¶ä¸­

int main() {
    std::allocator<int> alloc; // åˆ›å»ºä¸€ä¸ªç”¨äºåˆ†é…intç±»å‹çš„allocatorå¯¹è±¡
    int* p = alloc.allocate(5); // åˆ†é…èƒ½å­˜å‚¨5ä¸ªintçš„ç©ºé—´

    // æ„é€ è¿™äº›intå¯¹è±¡
    for (size_t i = 0; i < 5; ++i) {
        alloc.construct(&p[i], i); // åˆå§‹åŒ–æ¯ä¸ªå…ƒç´ 
    }

    // ä½¿ç”¨è¿™äº›intå¯¹è±¡...
    for (size_t i = 0; i < 5; ++i) {
        std::cout << p[i] << " ";
    }
    std::cout << std::endl;

    // é”€æ¯è¿™äº›intå¯¹è±¡
    for (size_t i = 0; i < 5; ++i) {
        alloc.destroy(&p[i]); // é”€æ¯æ¯ä¸ªå…ƒç´ 
    }

    alloc.deallocate(p, 5); // é‡Šæ”¾åˆ†é…çš„å†…å­˜

    return 0;
}
```

### new

- **`new`**ï¼šåˆ†é…å†…å­˜å¹¶æ„é€ å¯¹è±¡ï¼Œæ˜¯æœ€å¸¸ç”¨çš„åŠ¨æ€å†…å­˜åˆ†é…æ–¹å¼ã€‚
- **`operator new`**ï¼šåªè´Ÿè´£åˆ†é…å†…å­˜ï¼Œä¸è¿›è¡Œæ„é€ ã€‚å¯ä»¥è¢«é‡è½½ä»¥æä¾›å®šåˆ¶åŒ–çš„å†…å­˜åˆ†é…ç­–ç•¥ã€‚
- **`placement new`**ï¼šåœ¨å·²åˆ†é…çš„å†…å­˜ä¸­æ„é€ å¯¹è±¡ï¼Œé€‚ç”¨äºéœ€è¦ç²¾ç»†æ§åˆ¶å†…å­˜åˆ†é…çš„æƒ…å†µï¼Œå¦‚å†…å­˜æ± å®ç°ã€‚

```cpp
#include <new> // å¿…é¡»åŒ…å«è¿™ä¸ªå¤´æ–‡ä»¶æ¥ä½¿ç”¨placement new

char buffer[sizeof(MyClass)]; // é¢„å…ˆåˆ†é…çš„å†…å­˜
MyClass* obj = new(buffer) MyClass(); // åœ¨bufferä¸­æ„é€ å¯¹è±¡
```

ç†è§£å’Œæ­£ç¡®ä½¿ç”¨è¿™ä¸‰ä¸ªæ¦‚å¿µå¯ä»¥å¸®åŠ©æ›´é«˜æ•ˆåœ°ç®¡ç†å†…å­˜ï¼Œé¿å…å¸¸è§çš„å†…å­˜æ³„æ¼å’Œå…¶ä»–ä¸å†…å­˜ç®¡ç†ç›¸å…³çš„é—®é¢˜ã€‚



### è‡ªæ—‹é”

ä¸€ç§è½»é‡çº§çš„é”æœºåˆ¶ï¼Œç”¨äºå®ç°çº¿ç¨‹åŒæ­¥ã€‚å½“ä¸€ä¸ªçº¿ç¨‹å°è¯•è·å–é”æ—¶ï¼Œå¦‚æœé”å·²ç»è¢«å…¶ä»–çº¿ç¨‹å ç”¨ï¼Œå®ƒä¸ä¼šè¿›å…¥é˜»å¡çŠ¶æ€ï¼Œè€Œæ˜¯ä¸æ–­å°è¯•è·å–é”ï¼Œç›´åˆ°æˆåŠŸï¼Œè¿™ç§â€œå¿™ç­‰â€è¡Œä¸ºå°±å«ä½œâ€œè‡ªæ—‹â€ã€‚

åœ¨`fetchRange`å‡½æ•°ä»£ç ä¸­çš„éƒ¨åˆ†ï¼š

```cpp
while (locks_[index].test_and_set(std::memory_order_acquire));
```

- `test_and_set()`æ˜¯åŸå­æ“ä½œï¼Œå®ƒå°†locks_[index]è®¾ç½®ä¸ºtrueï¼Œå¹¶è¿”å›é”çš„åŸå§‹çŠ¶æ€ã€‚
- å¦‚æœè¿”å›å€¼è¡¨ç¤ºé”å·²ç»è¢«å ç”¨ï¼ˆtrueï¼‰ï¼Œçº¿ç¨‹ä¼šç»§ç»­å°è¯•è·å–é”ï¼ˆè‡ªæ—‹ï¼‰ã€‚
- è¿™ç§æ–¹å¼é¿å…äº†çº¿ç¨‹åˆ‡æ¢çš„å¼€é”€ã€‚

| è‡ªæ—‹é”                         | äº’æ–¥é”                   |
| ------------------------------ | ------------------------ |
| å¿™ç­‰ï¼Œåå¤å°è¯•è·å–é”           | é˜»å¡ï¼Œçº¿ç¨‹ä¼šè¢«æŒ‚èµ·       |
| é€‚åˆé”æŒæœ‰æ—¶é—´å¾ˆçŸ­çš„åœºæ™¯       | é€‚åˆé”æŒæœ‰æ—¶é—´è¾ƒé•¿çš„åœºæ™¯ |
| æ— éœ€æ“ä½œç³»ç»Ÿä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œæ€§èƒ½é«˜ | éœ€è¦ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå¼€é”€è¾ƒå¤§ |



## MemoryPool-v1 é¡¹ç›®æ¡†æ¶